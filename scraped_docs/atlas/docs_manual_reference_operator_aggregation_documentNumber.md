# $documentNumber (aggregation) - MongoDB Manual v8.0


Docs Home / MongoDB Manual / Aggregation Operations / Reference / Operators $documentNumber (aggregation) On this page Definition Behavior Examples Definition New in version 5.0 . $documentNumber Returns the position of a document (known as the document number) in the $setWindowFields stage partition . The $setWindowFields stage sortBy field determines the document number. For
more information on how MongoDB compares fields with different types,
see BSON comparison order . $documentNumber returns a unique number for each document in a partition , even if multiple
documents have identical sortBy field
values in the partition . $documentNumber is only available in the $setWindowFields stage. $documentNumber syntax: { $documentNumber: { } } $documentNumber does not accept any parameters. Behavior $documentNumber includes documents that have a sortBy field that is null or missing. $documentNumber , $rank , and $denseRank return
the position of the documents based on the sortBy field values. $documentNumber differs from $rank and $denseRank in how documents with identical sortBy field values in a partition are treated: $rank and $denseRank return the same position (known
as the rank) for those documents. $documentNumber returns a unique position (known as the
document number) for those documents. See the example in Document Number for Duplicate, Null, and Missing Values . Examples Document Number for Each State Create a cakeSales collection that contains cake sales in the states
of California ( CA ) and Washington ( WA ): db. cakeSales . insertMany ( [ { _id : 0 , type : "chocolate" , orderDate : new Date ( "2020-05-18T14:10:30Z" ) , state : "CA" , price : 13 , quantity : 120 } , { _id : 1 , type : "chocolate" , orderDate : new Date ( "2021-03-20T11:30:05Z" ) , state : "WA" , price : 14 , quantity : 140 } , { _id : 2 , type : "vanilla" , orderDate : new Date ( "2021-01-11T06:31:15Z" ) , state : "CA" , price : 12 , quantity : 145 } , { _id : 3 , type : "vanilla" , orderDate : new Date ( "2020-02-08T13:13:23Z" ) , state : "WA" , price : 13 , quantity : 104 } , { _id : 4 , type : "strawberry" , orderDate : new Date ( "2019-05-18T16:09:01Z" ) , state : "CA" , price : 41 , quantity : 162 } , { _id : 5 , type : "strawberry" , orderDate : new Date ( "2019-01-08T06:12:03Z" ) , state : "WA" , price : 43 , quantity : 134 } ] ) This example uses $documentNumber in the $setWindowFields stage to output the cake sales document
number for each state : db. cakeSales . aggregate ( [ { $setWindowFields : { partitionBy : "$state" , sortBy : { quantity : - 1 } , output : { documentNumberForState : { $documentNumber : { } } } } } ] ) In the example: partitionBy: "$state" partitions the documents in the collection by state . There are partitions for CA and WA . sortBy: { quantity: -1 } sorts the documents in each partition by quantity in descending order ( -1 ), so the highest quantity is first. output sets the document number in a new field called documentNumberForState shown in the following results. documentNumberForState is unique within each state partition. { "_id" : 4 , "type" : "strawberry" , "orderDate" : ISODate ( "2019-05-18T16:09:01Z" ) , "state" : "CA" , "price" : 41 , "quantity" : 162 , "documentNumberForState" : 1 } { "_id" : 2 , "type" : "vanilla" , "orderDate" : ISODate ( "2021-01-11T06:31:15Z" ) , "state" : "CA" , "price" : 12 , "quantity" : 145 , "documentNumberForState" : 2 } { "_id" : 0 , "type" : "chocolate" , "orderDate" : ISODate ( "2020-05-18T14:10:30Z" ) , "state" : "CA" , "price" : 13 , "quantity" : 120 , "documentNumberForState" : 3 } { "_id" : 1 , "type" : "chocolate" , "orderDate" : ISODate ( "2021-03-20T11:30:05Z" ) , "state" : "WA" , "price" : 14 , "quantity" : 140 , "documentNumberForState" : 1 } { "_id" : 5 , "type" : "strawberry" , "orderDate" : ISODate ( "2019-01-08T06:12:03Z" ) , "state" : "WA" , "price" : 43 , "quantity" : 134 , "documentNumberForState" : 2 } { "_id" : 3 , "type" : "vanilla" , "orderDate" : ISODate ( "2020-02-08T13:13:23Z" ) , "state" : "WA" , "price" : 13 , "quantity" : 104 , "documentNumberForState" : 3 } Document Number for Duplicate, Null, and Missing Values Create a cakeSalesWithDuplicates collection where: Cake sales are placed in the state of California ( CA ) and
Washington ( WA ). Documents 6 to 8 have the same quantity and state as document
5. Document 9 has the same quantity and state as document 4. Document 10 has a null quantity . Document 11 is missing the quantity . db. cakeSalesWithDuplicates . insertMany ( [ { _id : 0 , type : "chocolate" , orderDate : new Date ( "2020-05-18T14:10:30Z" ) , state : "CA" , price : 13 , quantity : 120 } , { _id : 1 , type : "chocolate" , orderDate : new Date ( "2021-03-20T11:30:05Z" ) , state : "WA" , price : 14 , quantity : 140 } , { _id : 2 , type : "vanilla" , orderDate : new Date ( "2021-01-11T06:31:15Z" ) , state : "CA" , price : 12 , quantity : 145 } , { _id : 3 , type : "vanilla" , orderDate : new Date ( "2020-02-08T13:13:23Z" ) , state : "WA" , price : 13 , quantity : 104 } , { _id : 4 , type : "strawberry" , orderDate : new Date ( "2019-05-18T16:09:01Z" ) , state : "CA" , price : 41 , quantity : 162 } , { _id : 5 , type : "strawberry" , orderDate : new Date ( "2019-01-08T06:12:03Z" ) , state : "WA" , price : 43 , quantity : 134 } , { _id : 6 , type : "strawberry" , orderDate : new Date ( "2020-01-08T06:12:03Z" ) , state : "WA" , price : 41 , quantity : 134 } , { _id : 7 , type : "strawberry" , orderDate : new Date ( "2020-01-01T06:12:03Z" ) , state : "WA" , price : 34 , quantity : 134 } , { _id : 8 , type : "strawberry" , orderDate : new Date ( "2020-01-02T06:12:03Z" ) , state : "WA" , price : 40 , quantity : 134 } , { _id : 9 , type : "strawberry" , orderDate : new Date ( "2020-05-11T16:09:01Z" ) , state : "CA" , price : 39 , quantity : 162 } , { _id : 10 , type : "strawberry" , orderDate : new Date ( "2020-05-11T16:09:01Z" ) , state : "CA" , price : 39 , quantity : null } , { _id : 11 , type : "strawberry" , orderDate : new Date ( "2020-05-11T16:09:01Z" ) , state : "CA" , price : 39 } ] ) This example uses $documentNumber in the $setWindowFields stage to output the cakeSalesWithDuplicates document number for each state : db. cakeSalesWithDuplicates . aggregate ( [ { $setWindowFields : { partitionBy : "$state" , sortBy : { quantity : - 1 } , output : { documentNumberForState : { $documentNumber : { } } } } } ] ) In the example: partitionBy: "$state" partitions the documents in the collection by state . There are partitions for CA and WA . sortBy: { quantity: -1 } sorts the documents in each partition by quantity in descending order ( -1 ), so the highest quantity is first. output sets the document number in a new field called documentNumberForState shown in the following results. documentNumberForState is unique within each state partition,
and there are documentNumberForState values for documents with null quantity and missing quantity values. { "_id" : 4 , "type" : "strawberry" , "orderDate" : ISODate ( "2019-05-18T16:09:01Z" ) , "state" : "CA" , "price" : 41 , "quantity" : 162 , "documentNumberForState" : 1 } { "_id" : 9 , "type" : "strawberry" , "orderDate" : ISODate ( "2020-05-11T16:09:01Z" ) , "state" : "CA" , "price" : 39 , "quantity" : 162 , "documentNumberForState" : 2 } { "_id" : 2 , "type" : "vanilla" , "orderDate" : ISODate ( "2021-01-11T06:31:15Z" ) , "state" : "CA" , "price" : 12 , "quantity" : 145 , "documentNumberForState" : 3 } { "_id" : 0 , "type" : "chocolate" , "orderDate" : ISODate ( "2020-05-18T14:10:30Z" ) , "state" : "CA" , "price" : 13 , "quantity" : 120 , "documentNumberForState" : 4 } { "_id" : 10 , "type" : "strawberry" , "orderDate" : ISODate ( "2020-05-11T16:09:01Z" ) , "state" : "CA" , "price" : 39 , "quantity" : null , "documentNumberForState" : 5 } { "_id" : 11 , "type" : "strawberry" , "orderDate" : ISODate ( "2020-05-11T16:09:01Z" ) , "state" : "CA" , "price" : 39 , "documentNumberForState" : 6 } { "_id" : 1 , "type" : "chocolate" , "orderDate" : ISODate ( "2021-03-20T11:30:05Z" ) , "state" : "WA" , "price" : 14 , "quantity" : 140 , "documentNumberForState" : 1 } { "_id" : 5 , "type" : "strawberry" , "orderDate" : ISODate ( "2019-01-08T06:12:03Z" ) , "state" : "WA" , "price" : 43 , "quantity" : 134 , "documentNumberForState" : 2 } { "_id" : 6 , "type" : "strawberry" , "orderDate" : ISODate ( "2020-01-08T06:12:03Z" ) , "state" : "WA" , "price" : 41 , "quantity" : 134 , "documentNumberForState" : 3 } { "_id" : 7 , "type" : "strawberry" , "orderDate" : ISODate ( "2020-01-01T06:12:03Z" ) , "state" : "WA" , "price" : 34 , "quantity" : 134 , "documentNumberForState" : 4 } { "_id" : 8 , "type" : "strawberry" , "orderDate" : ISODate ( "2020-01-02T06:12:03Z" ) , "state" : "WA" , "price" : 40 , "quantity" : 134 , "documentNumberForState" : 5 } { "_id" : 3 , "type" : "vanilla" , "orderDate" : ISODate ( "2020-02-08T13:13:23Z" ) , "state" : "WA" , "price" : 13 , "quantity" : 104 , "documentNumberForState" : 6 } Back $divide Next $eq
