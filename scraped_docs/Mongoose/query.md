# Query


# Query

[Mongoose](mongoose.html)

[Schema](schema.html)

[Connection](connection.html)

[Document](document.html)

[Model](model.html)

[Query](query.html)


Query()Query.prototype.$where()Query.prototype.all()Query.prototype.allowDiskUse()Query.prototype.and()Query.prototype.batchSize()Query.prototype.box()Query.prototype.cast()Query.prototype.catch()Query.prototype.center()Query.prototype.centerSphere()Query.prototype.circle()Query.prototype.clone()Query.prototype.collation()Query.prototype.comment()Query.prototype.countDocuments()Query.prototype.cursor()Query.prototype.deleteMany()Query.prototype.deleteOne()Query.prototype.distinct()Query.prototype.elemMatch()Query.prototype.equals()Query.prototype.error()Query.prototype.estimatedDocumentCount()Query.prototype.exec()Query.prototype.exists()Query.prototype.explain()Query.prototype.finally()Query.prototype.find()Query.prototype.findOne()Query.prototype.findOneAndDelete()Query.prototype.findOneAndReplace()Query.prototype.findOneAndUpdate()Query.prototype.geometry()Query.prototype.get()Query.prototype.getFilter()Query.prototype.getOptions()Query.prototype.getPopulatedPaths()Query.prototype.getQuery()Query.prototype.getUpdate()Query.prototype.gt()Query.prototype.gte()Query.prototype.hint()Query.prototype.in()Query.prototype.intersects()Query.prototype.isPathSelectedInclusive()Query.prototype.j()Query.prototype.lean()Query.prototype.limit()Query.prototype.lt()Query.prototype.lte()Query.prototype.maxDistance()Query.prototype.maxTimeMS()Query.prototype.merge()Query.prototype.mod()Query.prototype.modelQuery.prototype.mongooseOptions()Query.prototype.ne()Query.prototype.near()Query.prototype.nearSphere()Query.prototype.nin()Query.prototype.nor()Query.prototype.or()Query.prototype.orFail()Query.prototype.polygon()Query.prototype.populate()Query.prototype.post()Query.prototype.pre()Query.prototype.projection()Query.prototype.read()Query.prototype.readConcern()Query.prototype.regex()Query.prototype.replaceOne()Query.prototype.sanitizeProjection()Query.prototype.schemaLevelProjections()Query.prototype.select()Query.prototype.selected()Query.prototype.selectedExclusively()Query.prototype.selectedInclusively()Query.prototype.session()Query.prototype.set()Query.prototype.setOptions()Query.prototype.setQuery()Query.prototype.setUpdate()Query.prototype.size()Query.prototype.skip()Query.prototype.slice()Query.prototype.sort()Query.prototype.tailable()Query.prototype.then()Query.prototype.toConstructor()Query.prototype.transform()Query.prototype.updateMany()Query.prototype.updateOne()Query.prototype.w()Query.prototype.where()Query.prototype.within()Query.prototype.writeConcern()Query.prototype.wtimeout()Query.prototype[Symbol.asyncIterator]()Query.prototype[Symbol.toStringTag]()Query.use$geoWithin

- Query()

`Query()`
- Query.prototype.$where()

`Query.prototype.$where()`
- Query.prototype.all()

`Query.prototype.all()`
- Query.prototype.allowDiskUse()

`Query.prototype.allowDiskUse()`
- Query.prototype.and()

`Query.prototype.and()`
- Query.prototype.batchSize()

`Query.prototype.batchSize()`
- Query.prototype.box()

`Query.prototype.box()`
- Query.prototype.cast()

`Query.prototype.cast()`
- Query.prototype.catch()

`Query.prototype.catch()`
- Query.prototype.center()

`Query.prototype.center()`
- Query.prototype.centerSphere()

`Query.prototype.centerSphere()`
- Query.prototype.circle()

`Query.prototype.circle()`
- Query.prototype.clone()

`Query.prototype.clone()`
- Query.prototype.collation()

`Query.prototype.collation()`
- Query.prototype.comment()

`Query.prototype.comment()`
- Query.prototype.countDocuments()

`Query.prototype.countDocuments()`
- Query.prototype.cursor()

`Query.prototype.cursor()`
- Query.prototype.deleteMany()

`Query.prototype.deleteMany()`
- Query.prototype.deleteOne()

`Query.prototype.deleteOne()`
- Query.prototype.distinct()

`Query.prototype.distinct()`
- Query.prototype.elemMatch()

`Query.prototype.elemMatch()`
- Query.prototype.equals()

`Query.prototype.equals()`
- Query.prototype.error()

`Query.prototype.error()`
- Query.prototype.estimatedDocumentCount()

`Query.prototype.estimatedDocumentCount()`
- Query.prototype.exec()

`Query.prototype.exec()`
- Query.prototype.exists()

`Query.prototype.exists()`
- Query.prototype.explain()

`Query.prototype.explain()`
- Query.prototype.finally()

`Query.prototype.finally()`
- Query.prototype.find()

`Query.prototype.find()`
- Query.prototype.findOne()

`Query.prototype.findOne()`
- Query.prototype.findOneAndDelete()

`Query.prototype.findOneAndDelete()`
- Query.prototype.findOneAndReplace()

`Query.prototype.findOneAndReplace()`
- Query.prototype.findOneAndUpdate()

`Query.prototype.findOneAndUpdate()`
- Query.prototype.geometry()

`Query.prototype.geometry()`
- Query.prototype.get()

`Query.prototype.get()`
- Query.prototype.getFilter()

`Query.prototype.getFilter()`
- Query.prototype.getOptions()

`Query.prototype.getOptions()`
- Query.prototype.getPopulatedPaths()

`Query.prototype.getPopulatedPaths()`
- Query.prototype.getQuery()

`Query.prototype.getQuery()`
- Query.prototype.getUpdate()

`Query.prototype.getUpdate()`
- Query.prototype.gt()

`Query.prototype.gt()`
- Query.prototype.gte()

`Query.prototype.gte()`
- Query.prototype.hint()

`Query.prototype.hint()`
- Query.prototype.in()

`Query.prototype.in()`
- Query.prototype.intersects()

`Query.prototype.intersects()`
- Query.prototype.isPathSelectedInclusive()

`Query.prototype.isPathSelectedInclusive()`
- Query.prototype.j()

`Query.prototype.j()`
- Query.prototype.lean()

`Query.prototype.lean()`
- Query.prototype.limit()

`Query.prototype.limit()`
- Query.prototype.lt()

`Query.prototype.lt()`
- Query.prototype.lte()

`Query.prototype.lte()`
- Query.prototype.maxDistance()

`Query.prototype.maxDistance()`
- Query.prototype.maxTimeMS()

`Query.prototype.maxTimeMS()`
- Query.prototype.merge()

`Query.prototype.merge()`
- Query.prototype.mod()

`Query.prototype.mod()`
- Query.prototype.model

`Query.prototype.model`
- Query.prototype.mongooseOptions()

`Query.prototype.mongooseOptions()`
- Query.prototype.ne()

`Query.prototype.ne()`
- Query.prototype.near()

`Query.prototype.near()`
- Query.prototype.nearSphere()

`Query.prototype.nearSphere()`
- Query.prototype.nin()

`Query.prototype.nin()`
- Query.prototype.nor()

`Query.prototype.nor()`
- Query.prototype.or()

`Query.prototype.or()`
- Query.prototype.orFail()

`Query.prototype.orFail()`
- Query.prototype.polygon()

`Query.prototype.polygon()`
- Query.prototype.populate()

`Query.prototype.populate()`
- Query.prototype.post()

`Query.prototype.post()`
- Query.prototype.pre()

`Query.prototype.pre()`
- Query.prototype.projection()

`Query.prototype.projection()`
- Query.prototype.read()

`Query.prototype.read()`
- Query.prototype.readConcern()

`Query.prototype.readConcern()`
- Query.prototype.regex()

`Query.prototype.regex()`
- Query.prototype.replaceOne()

`Query.prototype.replaceOne()`
- Query.prototype.sanitizeProjection()

`Query.prototype.sanitizeProjection()`
- Query.prototype.schemaLevelProjections()

`Query.prototype.schemaLevelProjections()`
- Query.prototype.select()

`Query.prototype.select()`
- Query.prototype.selected()

`Query.prototype.selected()`
- Query.prototype.selectedExclusively()

`Query.prototype.selectedExclusively()`
- Query.prototype.selectedInclusively()

`Query.prototype.selectedInclusively()`
- Query.prototype.session()

`Query.prototype.session()`
- Query.prototype.set()

`Query.prototype.set()`
- Query.prototype.setOptions()

`Query.prototype.setOptions()`
- Query.prototype.setQuery()

`Query.prototype.setQuery()`
- Query.prototype.setUpdate()

`Query.prototype.setUpdate()`
- Query.prototype.size()

`Query.prototype.size()`
- Query.prototype.skip()

`Query.prototype.skip()`
- Query.prototype.slice()

`Query.prototype.slice()`
- Query.prototype.sort()

`Query.prototype.sort()`
- Query.prototype.tailable()

`Query.prototype.tailable()`
- Query.prototype.then()

`Query.prototype.then()`
- Query.prototype.toConstructor()

`Query.prototype.toConstructor()`
- Query.prototype.transform()

`Query.prototype.transform()`
- Query.prototype.updateMany()

`Query.prototype.updateMany()`
- Query.prototype.updateOne()

`Query.prototype.updateOne()`
- Query.prototype.w()

`Query.prototype.w()`
- Query.prototype.where()

`Query.prototype.where()`
- Query.prototype.within()

`Query.prototype.within()`
- Query.prototype.writeConcern()

`Query.prototype.writeConcern()`
- Query.prototype.wtimeout()

`Query.prototype.wtimeout()`
- Query.prototype[Symbol.asyncIterator]()

`Query.prototype[Symbol.asyncIterator]()`
- Query.prototype[Symbol.toStringTag]()

`Query.prototype[Symbol.toStringTag]()`
- Query.use$geoWithin

`Query.use$geoWithin`
[QueryCursor](querycursor.html)

[Aggregate](aggregate.html)

[AggregationCursor](aggregationcursor.html)

[SchemaType](schematype.html)

[VirtualType](virtualtype.html)

[Error](error.html)

[SchemaArray](schemaarray.html)

[SchemaDocumentArray](schemadocumentarray.html)

[SchemaSubdocument](schemasubdocument.html)

[SchemaBoolean](schemaboolean.html)

[SchemaBuffer](schemabuffer.html)

[SchemaNumber](schemanumber.html)

[SchemaObjectId](schemaobjectid.html)

[SchemaString](schemastring.html)

[DocumentArray](documentarray.html)

[Subdocument](subdocument.html)

[ArraySubdocument](arraysubdocument.html)

[Buffer](buffer.html)

[Decimal128](decimal128.html)

[Map](map.html)

[Array](array.html)


Query()Query.prototype.$where()Query.prototype.all()Query.prototype.allowDiskUse()Query.prototype.and()Query.prototype.batchSize()Query.prototype.box()Query.prototype.cast()Query.prototype.catch()Query.prototype.center()Query.prototype.centerSphere()Query.prototype.circle()Query.prototype.clone()Query.prototype.collation()Query.prototype.comment()Query.prototype.countDocuments()Query.prototype.cursor()Query.prototype.deleteMany()Query.prototype.deleteOne()Query.prototype.distinct()Query.prototype.elemMatch()Query.prototype.equals()Query.prototype.error()Query.prototype.estimatedDocumentCount()Query.prototype.exec()Query.prototype.exists()Query.prototype.explain()Query.prototype.finally()Query.prototype.find()Query.prototype.findOne()Query.prototype.findOneAndDelete()Query.prototype.findOneAndReplace()Query.prototype.findOneAndUpdate()Query.prototype.geometry()Query.prototype.get()Query.prototype.getFilter()Query.prototype.getOptions()Query.prototype.getPopulatedPaths()Query.prototype.getQuery()Query.prototype.getUpdate()Query.prototype.gt()Query.prototype.gte()Query.prototype.hint()Query.prototype.in()Query.prototype.intersects()Query.prototype.isPathSelectedInclusive()Query.prototype.j()Query.prototype.lean()Query.prototype.limit()Query.prototype.lt()Query.prototype.lte()Query.prototype.maxDistance()Query.prototype.maxTimeMS()Query.prototype.merge()Query.prototype.mod()Query.prototype.modelQuery.prototype.mongooseOptions()Query.prototype.ne()Query.prototype.near()Query.prototype.nearSphere()Query.prototype.nin()Query.prototype.nor()Query.prototype.or()Query.prototype.orFail()Query.prototype.polygon()Query.prototype.populate()Query.prototype.post()Query.prototype.pre()Query.prototype.projection()Query.prototype.read()Query.prototype.readConcern()Query.prototype.regex()Query.prototype.replaceOne()Query.prototype.sanitizeProjection()Query.prototype.schemaLevelProjections()Query.prototype.select()Query.prototype.selected()Query.prototype.selectedExclusively()Query.prototype.selectedInclusively()Query.prototype.session()Query.prototype.set()Query.prototype.setOptions()Query.prototype.setQuery()Query.prototype.setUpdate()Query.prototype.size()Query.prototype.skip()Query.prototype.slice()Query.prototype.sort()Query.prototype.tailable()Query.prototype.then()Query.prototype.toConstructor()Query.prototype.transform()Query.prototype.updateMany()Query.prototype.updateOne()Query.prototype.w()Query.prototype.where()Query.prototype.within()Query.prototype.writeConcern()Query.prototype.wtimeout()Query.prototype[Symbol.asyncIterator]()Query.prototype[Symbol.toStringTag]()Query.use$geoWithin

- Query()

`Query()`
- Query.prototype.$where()

`Query.prototype.$where()`
- Query.prototype.all()

`Query.prototype.all()`
- Query.prototype.allowDiskUse()

`Query.prototype.allowDiskUse()`
- Query.prototype.and()

`Query.prototype.and()`
- Query.prototype.batchSize()

`Query.prototype.batchSize()`
- Query.prototype.box()

`Query.prototype.box()`
- Query.prototype.cast()

`Query.prototype.cast()`
- Query.prototype.catch()

`Query.prototype.catch()`
- Query.prototype.center()

`Query.prototype.center()`
- Query.prototype.centerSphere()

`Query.prototype.centerSphere()`
- Query.prototype.circle()

`Query.prototype.circle()`
- Query.prototype.clone()

`Query.prototype.clone()`
- Query.prototype.collation()

`Query.prototype.collation()`
- Query.prototype.comment()

`Query.prototype.comment()`
- Query.prototype.countDocuments()

`Query.prototype.countDocuments()`
- Query.prototype.cursor()

`Query.prototype.cursor()`
- Query.prototype.deleteMany()

`Query.prototype.deleteMany()`
- Query.prototype.deleteOne()

`Query.prototype.deleteOne()`
- Query.prototype.distinct()

`Query.prototype.distinct()`
- Query.prototype.elemMatch()

`Query.prototype.elemMatch()`
- Query.prototype.equals()

`Query.prototype.equals()`
- Query.prototype.error()

`Query.prototype.error()`
- Query.prototype.estimatedDocumentCount()

`Query.prototype.estimatedDocumentCount()`
- Query.prototype.exec()

`Query.prototype.exec()`
- Query.prototype.exists()

`Query.prototype.exists()`
- Query.prototype.explain()

`Query.prototype.explain()`
- Query.prototype.finally()

`Query.prototype.finally()`
- Query.prototype.find()

`Query.prototype.find()`
- Query.prototype.findOne()

`Query.prototype.findOne()`
- Query.prototype.findOneAndDelete()

`Query.prototype.findOneAndDelete()`
- Query.prototype.findOneAndReplace()

`Query.prototype.findOneAndReplace()`
- Query.prototype.findOneAndUpdate()

`Query.prototype.findOneAndUpdate()`
- Query.prototype.geometry()

`Query.prototype.geometry()`
- Query.prototype.get()

`Query.prototype.get()`
- Query.prototype.getFilter()

`Query.prototype.getFilter()`
- Query.prototype.getOptions()

`Query.prototype.getOptions()`
- Query.prototype.getPopulatedPaths()

`Query.prototype.getPopulatedPaths()`
- Query.prototype.getQuery()

`Query.prototype.getQuery()`
- Query.prototype.getUpdate()

`Query.prototype.getUpdate()`
- Query.prototype.gt()

`Query.prototype.gt()`
- Query.prototype.gte()

`Query.prototype.gte()`
- Query.prototype.hint()

`Query.prototype.hint()`
- Query.prototype.in()

`Query.prototype.in()`
- Query.prototype.intersects()

`Query.prototype.intersects()`
- Query.prototype.isPathSelectedInclusive()

`Query.prototype.isPathSelectedInclusive()`
- Query.prototype.j()

`Query.prototype.j()`
- Query.prototype.lean()

`Query.prototype.lean()`
- Query.prototype.limit()

`Query.prototype.limit()`
- Query.prototype.lt()

`Query.prototype.lt()`
- Query.prototype.lte()

`Query.prototype.lte()`
- Query.prototype.maxDistance()

`Query.prototype.maxDistance()`
- Query.prototype.maxTimeMS()

`Query.prototype.maxTimeMS()`
- Query.prototype.merge()

`Query.prototype.merge()`
- Query.prototype.mod()

`Query.prototype.mod()`
- Query.prototype.model

`Query.prototype.model`
- Query.prototype.mongooseOptions()

`Query.prototype.mongooseOptions()`
- Query.prototype.ne()

`Query.prototype.ne()`
- Query.prototype.near()

`Query.prototype.near()`
- Query.prototype.nearSphere()

`Query.prototype.nearSphere()`
- Query.prototype.nin()

`Query.prototype.nin()`
- Query.prototype.nor()

`Query.prototype.nor()`
- Query.prototype.or()

`Query.prototype.or()`
- Query.prototype.orFail()

`Query.prototype.orFail()`
- Query.prototype.polygon()

`Query.prototype.polygon()`
- Query.prototype.populate()

`Query.prototype.populate()`
- Query.prototype.post()

`Query.prototype.post()`
- Query.prototype.pre()

`Query.prototype.pre()`
- Query.prototype.projection()

`Query.prototype.projection()`
- Query.prototype.read()

`Query.prototype.read()`
- Query.prototype.readConcern()

`Query.prototype.readConcern()`
- Query.prototype.regex()

`Query.prototype.regex()`
- Query.prototype.replaceOne()

`Query.prototype.replaceOne()`
- Query.prototype.sanitizeProjection()

`Query.prototype.sanitizeProjection()`
- Query.prototype.schemaLevelProjections()

`Query.prototype.schemaLevelProjections()`
- Query.prototype.select()

`Query.prototype.select()`
- Query.prototype.selected()

`Query.prototype.selected()`
- Query.prototype.selectedExclusively()

`Query.prototype.selectedExclusively()`
- Query.prototype.selectedInclusively()

`Query.prototype.selectedInclusively()`
- Query.prototype.session()

`Query.prototype.session()`
- Query.prototype.set()

`Query.prototype.set()`
- Query.prototype.setOptions()

`Query.prototype.setOptions()`
- Query.prototype.setQuery()

`Query.prototype.setQuery()`
- Query.prototype.setUpdate()

`Query.prototype.setUpdate()`
- Query.prototype.size()

`Query.prototype.size()`
- Query.prototype.skip()

`Query.prototype.skip()`
- Query.prototype.slice()

`Query.prototype.slice()`
- Query.prototype.sort()

`Query.prototype.sort()`
- Query.prototype.tailable()

`Query.prototype.tailable()`
- Query.prototype.then()

`Query.prototype.then()`
- Query.prototype.toConstructor()

`Query.prototype.toConstructor()`
- Query.prototype.transform()

`Query.prototype.transform()`
- Query.prototype.updateMany()

`Query.prototype.updateMany()`
- Query.prototype.updateOne()

`Query.prototype.updateOne()`
- Query.prototype.w()

`Query.prototype.w()`
- Query.prototype.where()

`Query.prototype.where()`
- Query.prototype.within()

`Query.prototype.within()`
- Query.prototype.writeConcern()

`Query.prototype.writeConcern()`
- Query.prototype.wtimeout()

`Query.prototype.wtimeout()`
- Query.prototype[Symbol.asyncIterator]()

`Query.prototype[Symbol.asyncIterator]()`
- Query.prototype[Symbol.toStringTag]()

`Query.prototype[Symbol.toStringTag]()`
- Query.use$geoWithin

`Query.use$geoWithin`

### Query()

[Query()](#Query())

`Query()`

[options]«Object»[model]«Object»[conditions]«Object»[collection]«Object»Mongoose collection

- [options]«Object»

`[options]`
- [model]«Object»

`[model]`
- [conditions]«Object»

`[conditions]`
- [collection]«Object»Mongoose collection

`[collection]`

Query constructor used for building queries. You do not need
to instantiate aQuerydirectly. Instead use Model functions likeModel.find().

`Query`
[Model.find()](/docs/api/model.html#Model.find())

`Model.find()`

#### Example:

[Example:](#example)


```javascript
constquery =MyModel.find();// `query` is an instance of `Query`query.setOptions({ lean :true});
query.collection(MyModel.collection);
query.where('age').gte(21).exec(callback);// You can instantiate a query directly. There is no need to do// this unless you're an advanced user with a very good reason to.constquery =newmongoose.Query();
```


### Query.prototype.$where()

[Query.prototype.$where()](#Query.prototype.$where())

`Query.prototype.$where()`

js«String|Function»javascript string or function

- js«String|Function»javascript string or function

`js`

«Query»this

- «Query»this


$where

- $where

[$where](https://www.mongodb.com/docs/manual/reference/operator/where/)


Specifies a javascript function or expression to pass to MongoDBs query system.


#### Example:

[Example:](#example)


```javascript
query.$where('this.comments.length === 10 || this.name.length === 5')// orquery.$where(function() {returnthis.comments.length===10||this.name.length===5;
})
```


#### Note:

[Note:](#note)


Only use$wherewhen you have a condition that cannot be met using other MongoDB operators like$lt.Be sure to read about all ofits caveatsbefore using.

`$where`
`$lt`
[its caveats](https://www.mongodb.com/docs/manual/reference/operator/where/)


### Query.prototype.all()

[Query.prototype.all()](#Query.prototype.all())

`Query.prototype.all()`

[path]«String»val«Array»

- [path]«String»

`[path]`
- val«Array»

`val`

$all

- $all

[$all](https://www.mongodb.com/docs/manual/reference/operator/all/)


Specifies an$allquery condition.

`$all`

When called with one argument, the most recent path passed towhere()is used.

`where()`

#### Example:

[Example:](#example)


```javascript
MyModel.find().where('pets').all(['dog','cat','ferret']);// Equivalent:MyModel.find().all('pets', ['dog','cat','ferret']);
```


### Query.prototype.allowDiskUse()

[Query.prototype.allowDiskUse()](#Query.prototype.allowDiskUse())

`Query.prototype.allowDiskUse()`

[v]«Boolean»Enable/disableallowDiskUse. If called with 0 arguments, setsallowDiskUse: true

- [v]«Boolean»Enable/disableallowDiskUse. If called with 0 arguments, setsallowDiskUse: true

`[v]`
`allowDiskUse`
`allowDiskUse: true`

«Query»this

- «Query»this


Sets theallowDiskUseoption,
which allows the MongoDB server to use more than 100 MB for this query'ssort(). This option can
let you work aroundQueryExceededMemoryLimitNoDiskUseAllowederrors from the MongoDB server.

[allowDiskUseoption](https://www.mongodb.com/docs/manual/reference/method/cursor.allowDiskUse/)

`allowDiskUse`
`sort()`
`QueryExceededMemoryLimitNoDiskUseAllowed`

Note that this option requires MongoDB server >= 4.4. Setting this option is a no-op for MongoDB 4.2
and earlier.


Callingquery.allowDiskUse(v)is equivalent toquery.setOptions({ allowDiskUse: v })

`query.allowDiskUse(v)`
`query.setOptions({ allowDiskUse: v })`

#### Example:

[Example:](#example)


```javascript
awaitquery.find().sort({name:1}).allowDiskUse(true);// Equivalent:awaitquery.find().sort({name:1}).allowDiskUse();
```


### Query.prototype.and()

[Query.prototype.and()](#Query.prototype.and())

`Query.prototype.and()`

array«Array»array of conditions

- array«Array»array of conditions

`array`

«Query»this

- «Query»this


$and

- $and

[$and](https://www.mongodb.com/docs/manual/reference/operator/and/)


Specifies arguments for a$andcondition.

`$and`

#### Example:

[Example:](#example)


```javascript
query.and([{color:'green'}, {status:'ok'}])
```


### Query.prototype.batchSize()

[Query.prototype.batchSize()](#Query.prototype.batchSize())

`Query.prototype.batchSize()`

val«Number»

- val«Number»

`val`

batchSize

- batchSize

[batchSize](https://www.mongodb.com/docs/manual/reference/method/cursor.batchSize/)


Specifies the batchSize option.


#### Example:

[Example:](#example)


```javascript
query.batchSize(100)
```


#### Note:

[Note:](#note)


Cannot be used withdistinct()

`distinct()`

### Query.prototype.box()

[Query.prototype.box()](#Query.prototype.box())

`Query.prototype.box()`

val1«Object|Array<Number>»Lower Left Coordinates OR a object of lower-left(ll) and upper-right(ur) Coordinates[val2]«Array<Number>»Upper Right Coordinates

- val1«Object|Array<Number>»Lower Left Coordinates OR a object of lower-left(ll) and upper-right(ur) Coordinates

`val1`
- [val2]«Array<Number>»Upper Right Coordinates

`[val2]`

«Query»this

- «Query»this


$boxwithin() Query#withinMongoDB Geospatial Indexing

- $box

[$box](https://www.mongodb.com/docs/manual/reference/operator/box/)

- within() Query#within

[within() Query#within](#Query.prototype.within())

- MongoDB Geospatial Indexing

[MongoDB Geospatial Indexing](https://www.mongodb.com/docs/manual/core/geospatial-indexes/)


Specifies a$boxcondition

`$box`

#### Example:

[Example:](#example)


```javascript
constlowerLeft = [40.73083, -73.99756]constupperRight= [40.741404,  -73.988135]

query.where('loc').within().box(lowerLeft, upperRight)
query.box({ ll : lowerLeft, ur : upperRight })
```


### Query.prototype.cast()

[Query.prototype.cast()](#Query.prototype.cast())

`Query.prototype.cast()`

[model]«Model»the model to cast to. If not set, defaults tothis.model[obj]«Object»

- [model]«Model»the model to cast to. If not set, defaults tothis.model

`[model]`
`this.model`
- [obj]«Object»

`[obj]`

«Object»

- «Object»


Casts this query to the schema ofmodel

`model`

#### Note:

[Note:](#note)


Ifobjis present, it is cast instead of this query.

`obj`

### Query.prototype.catch()

[Query.prototype.catch()](#Query.prototype.catch())

`Query.prototype.catch()`

[reject]«Function»

- [reject]«Function»

`[reject]`

«Promise»

- «Promise»


Executes the query returning aPromisewhich will be
resolved with either the doc(s) or rejected with the error.
Like.then(), but only takes a rejection handler.

`Promise`
`.then()`

More aboutPromisecatch()in JavaScript.

[Promisecatch()in JavaScript](https://masteringjs.io/tutorials/fundamentals/catch)

`catch()`

### Query.prototype.center()

[Query.prototype.center()](#Query.prototype.center())

`Query.prototype.center()`

DEPRECATEDAlias forcircle

[circle](#Query.prototype.circle())


Deprecated.Usecircleinstead.

[circle](#Query.prototype.circle())


### Query.prototype.centerSphere()

[Query.prototype.centerSphere()](#Query.prototype.centerSphere())

`Query.prototype.centerSphere()`

[path]«String»val«Object»

- [path]«String»

`[path]`
- val«Object»

`val`

«Query»this

- «Query»this


MongoDB Geospatial Indexing$centerSphere

- MongoDB Geospatial Indexing

[MongoDB Geospatial Indexing](https://www.mongodb.com/docs/manual/core/geospatial-indexes/)

- $centerSphere

[$centerSphere](https://www.mongodb.com/docs/manual/reference/operator/centerSphere/)


DEPRECATEDSpecifies a$centerSpherecondition

`$centerSphere`

Deprecated.Usecircleinstead.

[circle](#Query.prototype.circle())


#### Example:

[Example:](#example)


```javascript
constarea = {center: [50,50],radius:10};
query.where('loc').within().centerSphere(area);
```


### Query.prototype.circle()

[Query.prototype.circle()](#Query.prototype.circle())

`Query.prototype.circle()`

[path]«String»area«Object»

- [path]«String»

`[path]`
- area«Object»

`area`

«Query»this

- «Query»this


$center$centerSphere$geoWithinMongoDB Geospatial Indexing

- $center

[$center](https://www.mongodb.com/docs/manual/reference/operator/center/)

- $centerSphere

[$centerSphere](https://www.mongodb.com/docs/manual/reference/operator/centerSphere/)

- $geoWithin

[$geoWithin](https://www.mongodb.com/docs/manual/reference/operator/geoWithin/)

- MongoDB Geospatial Indexing

[MongoDB Geospatial Indexing](https://www.mongodb.com/docs/manual/core/geospatial-indexes/)


Specifies a$centeror$centerSpherecondition.

`$center`
`$centerSphere`

#### Example:

[Example:](#example)


```javascript
constarea = {center: [50,50],radius:10,unique:true}
query.where('loc').within().circle(area)// alternativelyquery.circle('loc', area);// spherical calculationsconstarea = {center: [50,50],radius:10,unique:true,spherical:true}
query.where('loc').within().circle(area)// alternativelyquery.circle('loc', area);
```


### Query.prototype.clone()

[Query.prototype.clone()](#Query.prototype.clone())

`Query.prototype.clone()`

«Query»copy

- «Query»copy


Make a copy of this query so you can re-execute it.


#### Example:

[Example:](#example)


```javascript
constq =Book.findOne({title:'Casino Royale'});awaitq.exec();awaitq.exec();// Throws an error because you can't execute a query twiceawaitq.clone().exec();// Works
```


### Query.prototype.collation()

[Query.prototype.collation()](#Query.prototype.collation())

`Query.prototype.collation()`

value«Object»

- value«Object»

`value`

«Query»this

- «Query»this


MongoDB docs

- MongoDB docs

[MongoDB docs](https://www.mongodb.com/docs/manual/reference/method/cursor.collation/#cursor.collation)


Adds a collation to this op (MongoDB 3.4 and up)


### Query.prototype.comment()

[Query.prototype.comment()](#Query.prototype.comment())

`Query.prototype.comment()`

val«String»

- val«String»

`val`

comment

- comment

[comment](https://www.mongodb.com/docs/manual/reference/operator/comment/)


Specifies thecommentoption.

`comment`

#### Example:

[Example:](#example)


```javascript
query.comment('login query')
```


#### Note:

[Note:](#note)


Cannot be used withdistinct()

`distinct()`

### Query.prototype.countDocuments()

[Query.prototype.countDocuments()](#Query.prototype.countDocuments())

`Query.prototype.countDocuments()`

[filter]«Object»mongodb selector[options]«Object»

- [filter]«Object»mongodb selector

`[filter]`
- [options]«Object»

`[options]`

«Query»this

- «Query»this


countDocuments

- countDocuments

[countDocuments](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments)


Specifies this query as acountDocuments()query. Behaves likecount(),
except it always does a full collection scan when passed an empty filter{}.

`countDocuments()`
`count()`
`{}`

There are also minor differences in howcountDocuments()handles$whereand a couple geospatial operators.
versuscount().

`countDocuments()`
[$whereand a couple geospatial operators](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments)

`$where`
`count()`

This function triggers the following middleware.


countDocuments()

- countDocuments()

`countDocuments()`

#### Example:

[Example:](#example)


```javascript
constcountQuery = model.where({'color':'black'}).countDocuments();

query.countDocuments({color:'black'}).count().exec();awaitquery.countDocuments({color:'black'});

query.where('color','black').countDocuments().exec();
```


ThecountDocuments()function is similar tocount(), but there are afew operators thatcountDocuments()does not support.
Below are the operators thatcount()supports butcountDocuments()does not,
and the suggested replacement:

`countDocuments()`
`count()`
[few operators thatcountDocuments()does not support](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#countDocuments)

`countDocuments()`
`count()`
`countDocuments()`

$where:$expr$near:$geoWithinwith$center$nearSphere:$geoWithinwith$centerSphere

- $where:$expr

`$where`
`$expr`
- $near:$geoWithinwith$center

`$near`
`$geoWithin`
`$center`
- $nearSphere:$geoWithinwith$centerSphere

`$nearSphere`
`$geoWithin`
`$centerSphere`

### Query.prototype.cursor()

[Query.prototype.cursor()](#Query.prototype.cursor())

`Query.prototype.cursor()`

[options]«Object»

- [options]«Object»

`[options]`

«QueryCursor»

- «QueryCursor»


QueryCursor

- QueryCursor

[QueryCursor](/docs/api/querycursor.html)


Returns a wrapper around amongodb driver cursor.
A QueryCursor exposes a Streams3 interface, as well as a.next()function.

[mongodb driver cursor](https://mongodb.github.io/node-mongodb-native/4.9/classes/FindCursor.html)

`.next()`

The.cursor()function triggers pre find hooks, butnotpost find hooks.

`.cursor()`

#### Example:

[Example:](#example)


```javascript
// There are 2 ways to use a cursor. First, as a stream:Thing.find({name:/^hello/}).cursor().on('data',function(doc) {console.log(doc); }).on('end',function() {console.log('Done!'); });// Or you can use `.next()` to manually get the next doc in the stream.// `.next()` returns a promise, so you can use promises or callbacks.constcursor =Thing.find({name:/^hello/}).cursor();
cursor.next(function(error, doc) {console.log(doc);
});// Because `.next()` returns a promise, you can use co// to easily iterate through all documents without loading them// all into memory.constcursor =Thing.find({name:/^hello/}).cursor();for(letdoc =awaitcursor.next(); doc !=null; doc =awaitcursor.next()) {console.log(doc);
}
```


#### Valid options

[Valid options](#valid-options)


transform: optional function which accepts a mongoose document. The return value of the function will be emitted ondataand returned by.next().

- transform: optional function which accepts a mongoose document. The return value of the function will be emitted ondataand returned by.next().

`transform`
`data`
`.next()`

### Query.prototype.deleteMany()

[Query.prototype.deleteMany()](#Query.prototype.deleteMany())

`Query.prototype.deleteMany()`

[filter]«Object|Query»mongodb selector[options]«Object»optional seeQuery.prototype.setOptions()

- [filter]«Object|Query»mongodb selector

`[filter]`
- [options]«Object»optional seeQuery.prototype.setOptions()

`[options]`
`Query.prototype.setOptions()`

«Query»this

- «Query»this


DeleteResultdeleteMany

- DeleteResult

[DeleteResult](https://mongodb.github.io/node-mongodb-native/4.9/interfaces/DeleteResult.html)

- deleteMany

[deleteMany](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteMany)


Declare and/or execute this query as adeleteMany()operation. Works like
remove, except it deleteseverydocument that matchesfilterin the
collection, regardless of the value ofsingle.

`deleteMany()`
`filter`
`single`

This function triggersdeleteManymiddleware.

`deleteMany`

#### Example:

[Example:](#example)


```javascript
awaitCharacter.deleteMany({name:/Stark/,age: {$gte:18} });
```


This function calls the MongoDB driver'sCollection#deleteMany()function.
The returnedpromiseresolves to an
object that contains 3 properties:

[Collection#deleteMany()function](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteMany)

`Collection#deleteMany()`
[promise](/docs/queries.html)


ok:1if no errors occurreddeletedCount: the number of documents deletedn: the number of documents deleted. Equal todeletedCount.

- ok:1if no errors occurred

`ok`
`1`
- deletedCount: the number of documents deleted

`deletedCount`
- n: the number of documents deleted. Equal todeletedCount.

`n`
`deletedCount`

#### Example:

[Example:](#example)


```javascript
constres =awaitCharacter.deleteMany({name:/Stark/,age: {$gte:18} });// `0` if no docs matched the filter, number of docs deleted otherwiseres.deletedCount;
```


### Query.prototype.deleteOne()

[Query.prototype.deleteOne()](#Query.prototype.deleteOne())

`Query.prototype.deleteOne()`

[filter]«Object|Query»mongodb selector[options]«Object»optional seeQuery.prototype.setOptions()

- [filter]«Object|Query»mongodb selector

`[filter]`
- [options]«Object»optional seeQuery.prototype.setOptions()

`[options]`
`Query.prototype.setOptions()`

«Query»this

- «Query»this


DeleteResultdeleteOne

- DeleteResult

[DeleteResult](https://mongodb.github.io/node-mongodb-native/4.9/interfaces/DeleteResult.html)

- deleteOne

[deleteOne](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteOne)


Declare and/or execute this query as adeleteOne()operation. Works like
remove, except it deletes at most one document regardless of thesingleoption.

`deleteOne()`
`single`

This function triggersdeleteOnemiddleware.

`deleteOne`

#### Example:

[Example:](#example)


```javascript
awaitCharacter.deleteOne({name:'Eddard Stark'});
```


This function calls the MongoDB driver'sCollection#deleteOne()function.
The returnedpromiseresolves to an
object that contains 3 properties:

[Collection#deleteOne()function](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#deleteOne)

`Collection#deleteOne()`
[promise](/docs/queries.html)


ok:1if no errors occurreddeletedCount: the number of documents deletedn: the number of documents deleted. Equal todeletedCount.

- ok:1if no errors occurred

`ok`
`1`
- deletedCount: the number of documents deleted

`deletedCount`
- n: the number of documents deleted. Equal todeletedCount.

`n`
`deletedCount`

#### Example:

[Example:](#example)


```javascript
constres =awaitCharacter.deleteOne({name:'Eddard Stark'});// `1` if MongoDB deleted a doc, `0` if no docs matched the filter `{ name: ... }`res.deletedCount;
```


### Query.prototype.distinct()

[Query.prototype.distinct()](#Query.prototype.distinct())

`Query.prototype.distinct()`

[field]«String»[filter]«Object|Query»[options]«Object»

- [field]«String»

`[field]`
- [filter]«Object|Query»

`[filter]`
- [options]«Object»

`[options]`

«Query»this

- «Query»this


distinct

- distinct

[distinct](https://www.mongodb.com/docs/manual/reference/method/db.collection.distinct/)


Declares or executes a distinct() operation.


This function does not trigger any middleware.


#### Example:

[Example:](#example)


```javascript
distinct(field, conditions, options)distinct(field, conditions)distinct(field)distinct()
```


### Query.prototype.elemMatch()

[Query.prototype.elemMatch()](#Query.prototype.elemMatch())

`Query.prototype.elemMatch()`

path«String|Object|Function»filter«Object|Function»

- path«String|Object|Function»

`path`
- filter«Object|Function»

`filter`

«Query»this

- «Query»this


$elemMatch

- $elemMatch

[$elemMatch](https://www.mongodb.com/docs/manual/reference/operator/elemMatch/)


Specifies an$elemMatchcondition

`$elemMatch`

#### Example:

[Example:](#example)


```javascript
query.elemMatch('comment', {author:'autobot',votes: {$gte:5}})

query.where('comment').elemMatch({author:'autobot',votes: {$gte:5}})

query.elemMatch('comment',function(elem) {
  elem.where('author').equals('autobot');
  elem.where('votes').gte(5);
})

query.where('comment').elemMatch(function(elem) {
  elem.where({author:'autobot'});
  elem.where('votes').gte(5);
})
```


### Query.prototype.equals()

[Query.prototype.equals()](#Query.prototype.equals())

`Query.prototype.equals()`

val«Object»

- val«Object»

`val`

«Query»this

- «Query»this


Specifies the complementary comparison value for paths specified withwhere()

`where()`

#### Example:

[Example:](#example)


```javascript
User.where('age').equals(49);// is the same asUser.where('age',49);
```


### Query.prototype.error()

[Query.prototype.error()](#Query.prototype.error())

`Query.prototype.error()`

err«Error|null»if set,exec()will fail fast before sending the query to MongoDB

- err«Error|null»if set,exec()will fail fast before sending the query to MongoDB

`err`
`exec()`

«Query»this

- «Query»this


Gets/sets the error flag on this query. If this flag is not null or
undefined, theexec()promise will reject without executing.

`exec()`

#### Example:

[Example:](#example)


```javascript
Query().error();// Get current error valueQuery().error(null);// Unset the current errorQuery().error(newError('test'));// `exec()` will resolve with testSchema.pre('find',function() {if(!this.getQuery().userId) {this.error(newError('Not allowed to query without setting userId'));
  }
});
```


Note that query casting runsafterhooks, so cast errors will override
custom errors.


#### Example:

[Example:](#example)


```javascript
constTestSchema=newSchema({num:Number});constTestModel= db.model('Test',TestSchema);TestModel.find({num:'not a number'}).error(newError('woops')).exec(function(error) {// `error` will be a cast error because `num` failed to cast});
```


### Query.prototype.estimatedDocumentCount()

[Query.prototype.estimatedDocumentCount()](#Query.prototype.estimatedDocumentCount())

`Query.prototype.estimatedDocumentCount()`

[options]«Object»passed transparently to theMongoDB driver

- [options]«Object»passed transparently to theMongoDB driver

`[options]`

«Query»this

- «Query»this


estimatedDocumentCount

- estimatedDocumentCount

[estimatedDocumentCount](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#estimatedDocumentCount)


Specifies this query as aestimatedDocumentCount()query. Faster than
usingcountDocuments()for large collections becauseestimatedDocumentCount()uses collection metadata rather than scanning
the entire collection.

`estimatedDocumentCount()`
`countDocuments()`
`estimatedDocumentCount()`

estimatedDocumentCount()doesnotaccept a filter.Model.find({ foo: bar }).estimatedDocumentCount()is equivalent toModel.find().estimatedDocumentCount()

`estimatedDocumentCount()`
`Model.find({ foo: bar }).estimatedDocumentCount()`
`Model.find().estimatedDocumentCount()`

This function triggers the following middleware.


estimatedDocumentCount()

- estimatedDocumentCount()

`estimatedDocumentCount()`

#### Example:

[Example:](#example)


```javascript
awaitModel.find().estimatedDocumentCount();
```


### Query.prototype.exec()

[Query.prototype.exec()](#Query.prototype.exec())

`Query.prototype.exec()`

[operation]«String|Function»

- [operation]«String|Function»

`[operation]`

«Promise»

- «Promise»


Executes the query


#### Example:

[Example:](#example)


```javascript
constpromise = query.exec();constpromise = query.exec('update');
```


### Query.prototype.exists()

[Query.prototype.exists()](#Query.prototype.exists())

`Query.prototype.exists()`

[path]«String»val«Boolean»

- [path]«String»

`[path]`
- val«Boolean»

`val`

«Query»this

- «Query»this


$exists

- $exists

[$exists](https://www.mongodb.com/docs/manual/reference/operator/exists/)


Specifies an$existscondition

`$exists`

#### Example:

[Example:](#example)


```javascript
// { name: { $exists: true }}Thing.where('name').exists()Thing.where('name').exists(true)Thing.find().exists('name')// { name: { $exists: false }}Thing.where('name').exists(false);Thing.find().exists('name',false);
```


### Query.prototype.explain()

[Query.prototype.explain()](#Query.prototype.explain())

`Query.prototype.explain()`

[verbose]«String»The verbosity mode. Either 'queryPlanner', 'executionStats', or 'allPlansExecution'. The default is 'queryPlanner'

- [verbose]«String»The verbosity mode. Either 'queryPlanner', 'executionStats', or 'allPlansExecution'. The default is 'queryPlanner'

`[verbose]`

«Query»this

- «Query»this


Sets theexplainoption,
which makes this query return detailed execution stats instead of the actual
query result. This method is useful for determining what index your queries
use.

[explainoption](https://www.mongodb.com/docs/manual/reference/method/cursor.explain/)

`explain`

Callingquery.explain(v)is equivalent toquery.setOptions({ explain: v })

`query.explain(v)`
`query.setOptions({ explain: v })`

#### Example:

[Example:](#example)


```javascript
constquery =newQuery();constres =awaitquery.find({a:1}).explain('queryPlanner');console.log(res);
```


### Query.prototype.finally()

[Query.prototype.finally()](#Query.prototype.finally())

`Query.prototype.finally()`

[onFinally]«Function»

- [onFinally]«Function»

`[onFinally]`

«Promise»

- «Promise»


Executes the query returning aPromisewhich will be
resolved with.finally()chained.

`Promise`
`.finally()`

More aboutPromisefinally()in JavaScript.

[Promisefinally()in JavaScript](https://thecodebarbarian.com/using-promise-finally-in-node-js.html)

`finally()`

### Query.prototype.find()

[Query.prototype.find()](#Query.prototype.find())

`Query.prototype.find()`

[filter]«Object|ObjectId»mongodb filter. If not specified, returns all documents.

- [filter]«Object|ObjectId»mongodb filter. If not specified, returns all documents.

`[filter]`

«Query»this

- «Query»this


Find all documents that matchselector. The result will be an array of documents.

`selector`

If there are too many documents in the result to fit in memory, useQuery.prototype.cursor()

[Query.prototype.cursor()](#Query.prototype.cursor())

`Query.prototype.cursor()`

#### Example:

[Example:](#example)


```javascript
constarr =awaitMovie.find({year: {$gte:1980,$lte:1989} });
```


### Query.prototype.findOne()

[Query.prototype.findOne()](#Query.prototype.findOne())

`Query.prototype.findOne()`

[filter]«Object»mongodb selector[projection]«Object»optional fields to return[options]«Object»seesetOptions()[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

- [filter]«Object»mongodb selector

`[filter]`
- [projection]«Object»optional fields to return

`[projection]`
- [options]«Object»seesetOptions()

`[options]`
`setOptions()`

[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

- [options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

`[options.translateAliases=null]`
`true`
`filter`
`projection`
`update`
`distinct`

«Query»this

- «Query»this


findOneQuery.select

- findOne

[findOne](https://www.mongodb.com/docs/manual/reference/method/db.collection.findOne/)

- Query.select

[Query.select](#Query.prototype.select())


Declares the query a findOne operation. When executed, the first found document is passed to the callback.


The result of the query is a single document, ornullif no document was found.

`null`

Note:conditionsis optional, and ifconditionsis null or undefined,
mongoose will send an emptyfindOnecommand to MongoDB, which will return
an arbitrary document. If you're querying by_id, useModel.findById()instead.

- Note:conditionsis optional, and ifconditionsis null or undefined,
mongoose will send an emptyfindOnecommand to MongoDB, which will return
an arbitrary document. If you're querying by_id, useModel.findById()instead.

`conditions`
`conditions`
`findOne`
`_id`
`Model.findById()`

This function triggers the following middleware.


findOne()

- findOne()

`findOne()`

#### Example:

[Example:](#example)


```javascript
constquery =Kitten.where({color:'white'});constkitten =awaitquery.findOne();
```


### Query.prototype.findOneAndDelete()

[Query.prototype.findOneAndDelete()](#Query.prototype.findOneAndDelete())

`Query.prototype.findOneAndDelete()`

[filter]«Object»[options]«Object»[options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [filter]«Object»

`[filter]`
- [options]«Object»

`[options]`

[options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document

- [options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document

`[options.includeResultMetadata]`

[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

- [options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

`[options.session=null]`

[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [options.strict]«Boolean|String»overwrites the schema'sstrict mode option

`[options.strict]`

«Query»this

- «Query»this


findAndModify command

- findAndModify command

[findAndModify command](https://www.mongodb.com/docs/manual/reference/command/findAndModify/)


Issues a MongoDBfindOneAndDeletecommand.

[findOneAndDelete](https://www.mongodb.com/docs/manual/reference/method/db.collection.findOneAndDelete/)


Finds a matching document, removes it, and returns the found document (if any).


This function triggers the following middleware.


findOneAndDelete()

- findOneAndDelete()

`findOneAndDelete()`

#### Available options

[Available options](#available-options)


sort: if multiple docs are found by the conditions, sets the sort order to choose which doc to updatemaxTimeMS: puts a time limit on the query - requires mongodb >= 2.6.0

- sort: if multiple docs are found by the conditions, sets the sort order to choose which doc to update

`sort`
- maxTimeMS: puts a time limit on the query - requires mongodb >= 2.6.0

`maxTimeMS`

#### Callback Signature

[Callback Signature](#callback-signature)


```javascript
function(error, doc) {// error: any errors that occurred// doc: the document before updates are applied if `new: false`, or after updates if `new = true`}
```


#### Example:

[Example:](#example)


```javascript
A.where().findOneAndDelete(conditions, options)// return QueryA.where().findOneAndDelete(conditions)// returns QueryA.where().findOneAndDelete()// returns Query
```


### Query.prototype.findOneAndReplace()

[Query.prototype.findOneAndReplace()](#Query.prototype.findOneAndReplace())

`Query.prototype.findOneAndReplace()`

[filter]«Object»[replacement]«Object»[options]«Object»[options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.[options.strict]«Boolean|String»overwrites the schema'sstrict mode option[options.new=false]«Boolean»By default,findOneAndUpdate()returns the document as it wasbeforeupdatewas applied. If you setnew: true,findOneAndUpdate()will instead give you the object afterupdatewas applied.[options.lean]«Object»if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. SeeQuery.lean()andthe Mongoose lean tutorial.[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.[options.strict]«Boolean|String»overwrites the schema'sstrict mode option[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.[options.returnOriginal=null]«Boolean»An alias for thenewoption.returnOriginal: falseis equivalent tonew: true.[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

- [filter]«Object»

`[filter]`
- [replacement]«Object»

`[replacement]`
- [options]«Object»

`[options]`

[options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document

- [options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document

`[options.includeResultMetadata]`

[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

- [options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

`[options.session=null]`

[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [options.strict]«Boolean|String»overwrites the schema'sstrict mode option

`[options.strict]`

[options.new=false]«Boolean»By default,findOneAndUpdate()returns the document as it wasbeforeupdatewas applied. If you setnew: true,findOneAndUpdate()will instead give you the object afterupdatewas applied.

- [options.new=false]«Boolean»By default,findOneAndUpdate()returns the document as it wasbeforeupdatewas applied. If you setnew: true,findOneAndUpdate()will instead give you the object afterupdatewas applied.

`[options.new=false]`
`findOneAndUpdate()`
`update`
`new: true`
`findOneAndUpdate()`
`update`

[options.lean]«Object»if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. SeeQuery.lean()andthe Mongoose lean tutorial.

- [options.lean]«Object»if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. SeeQuery.lean()andthe Mongoose lean tutorial.

`[options.lean]`
`Query.lean()`

[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

- [options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

`[options.session=null]`

[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [options.strict]«Boolean|String»overwrites the schema'sstrict mode option

`[options.strict]`

[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.

- [options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.

`[options.timestamps=null]`
`false`

[options.returnOriginal=null]«Boolean»An alias for thenewoption.returnOriginal: falseis equivalent tonew: true.

- [options.returnOriginal=null]«Boolean»An alias for thenewoption.returnOriginal: falseis equivalent tonew: true.

`[options.returnOriginal=null]`
`new`
`returnOriginal: false`
`new: true`

[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

- [options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

`[options.translateAliases=null]`
`true`
`filter`
`projection`
`update`
`distinct`

«Query»this

- «Query»this


Issues a MongoDBfindOneAndReplacecommand.

[findOneAndReplace](https://www.mongodb.com/docs/manual/reference/method/db.collection.findOneAndReplace/)


Finds a matching document, removes it, and returns the found document (if any).


This function triggers the following middleware.


findOneAndReplace()

- findOneAndReplace()

`findOneAndReplace()`

#### Available options

[Available options](#available-options)


sort: if multiple docs are found by the conditions, sets the sort order to choose which doc to updatemaxTimeMS: puts a time limit on the query - requires mongodb >= 2.6.0includeResultMetadata: if true, returns the fullModifyResult from the MongoDB driverrather than just the document

- sort: if multiple docs are found by the conditions, sets the sort order to choose which doc to update

`sort`
- maxTimeMS: puts a time limit on the query - requires mongodb >= 2.6.0

`maxTimeMS`
- includeResultMetadata: if true, returns the fullModifyResult from the MongoDB driverrather than just the document

`includeResultMetadata`

#### Callback Signature

[Callback Signature](#callback-signature)


```javascript
function(error, doc) {// error: any errors that occurred// doc: the document before updates are applied if `new: false`, or after updates if `new = true`}
```


#### Example:

[Example:](#example)


```javascript
A.where().findOneAndReplace(filter, replacement, options);// return QueryA.where().findOneAndReplace(filter);// returns QueryA.where().findOneAndReplace();// returns Query
```


### Query.prototype.findOneAndUpdate()

[Query.prototype.findOneAndUpdate()](#Query.prototype.findOneAndUpdate())

`Query.prototype.findOneAndUpdate()`

[filter]«Object|Query»[doc]«Object»[options]«Object»[options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document[options.strict]«Boolean|String»overwrites the schema'sstrict mode option[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.[options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.[options.new=false]«Boolean»By default,findOneAndUpdate()returns the document as it wasbeforeupdatewas applied. If you setnew: true,findOneAndUpdate()will instead give you the object afterupdatewas applied.[options.lean]«Object»if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. SeeQuery.lean()andthe Mongoose lean tutorial.[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.[options.strict]«Boolean|String»overwrites the schema'sstrict mode option[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.[options.returnOriginal=null]«Boolean»An alias for thenewoption.returnOriginal: falseis equivalent tonew: true.[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.[options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key[options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.

- [filter]«Object|Query»

`[filter]`
- [doc]«Object»

`[doc]`
- [options]«Object»

`[options]`

[options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document

- [options.includeResultMetadata]«Boolean»if true, returns the fullModifyResult from the MongoDB driverrather than just the document

`[options.includeResultMetadata]`

[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [options.strict]«Boolean|String»overwrites the schema'sstrict mode option

`[options.strict]`

[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

- [options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

`[options.session=null]`

[options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.

- [options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.

`[options.multipleCastError]`

[options.new=false]«Boolean»By default,findOneAndUpdate()returns the document as it wasbeforeupdatewas applied. If you setnew: true,findOneAndUpdate()will instead give you the object afterupdatewas applied.

- [options.new=false]«Boolean»By default,findOneAndUpdate()returns the document as it wasbeforeupdatewas applied. If you setnew: true,findOneAndUpdate()will instead give you the object afterupdatewas applied.

`[options.new=false]`
`findOneAndUpdate()`
`update`
`new: true`
`findOneAndUpdate()`
`update`

[options.lean]«Object»if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. SeeQuery.lean()andthe Mongoose lean tutorial.

- [options.lean]«Object»if truthy, mongoose will return the document as a plain JavaScript object rather than a mongoose document. SeeQuery.lean()andthe Mongoose lean tutorial.

`[options.lean]`
`Query.lean()`

[options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

- [options.session=null]«ClientSession»The session associated with this query. Seetransactions docs.

`[options.session=null]`

[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [options.strict]«Boolean|String»overwrites the schema'sstrict mode option

`[options.strict]`

[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.

- [options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.

`[options.timestamps=null]`
`false`

[options.returnOriginal=null]«Boolean»An alias for thenewoption.returnOriginal: falseis equivalent tonew: true.

- [options.returnOriginal=null]«Boolean»An alias for thenewoption.returnOriginal: falseis equivalent tonew: true.

`[options.returnOriginal=null]`
`new`
`returnOriginal: false`
`new: true`

[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

- [options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

`[options.translateAliases=null]`
`true`
`filter`
`projection`
`update`
`distinct`

[options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key

- [options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key

`[options.overwriteDiscriminatorKey=false]`
`update`
`overwriteDiscriminatorKey`
`true`

[options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.

- [options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.

`[options.overwriteImmutable=false]`
`update`
`overwriteImmutable`
`true`

«Query»this

- «Query»this


TutorialfindAndModify commandModifyResultfindOneAndUpdate

- Tutorial

[Tutorial](/docs/tutorials/findoneandupdate.html)

- findAndModify command

[findAndModify command](https://www.mongodb.com/docs/manual/reference/command/findAndModify/)

- ModifyResult

[ModifyResult](https://mongodb.github.io/node-mongodb-native/4.9/interfaces/ModifyResult.html)

- findOneAndUpdate

[findOneAndUpdate](https://mongodb.github.io/node-mongodb-native/4.9/classes/Collection.html#findOneAndUpdate)


Issues a mongodbfindOneAndUpdate()command.

`findOneAndUpdate()`

Finds a matching document, updates it according to theupdatearg, passing anyoptions, and returns the found
document (if any).

`update`
`options`

This function triggers the following middleware.


findOneAndUpdate()

- findOneAndUpdate()

`findOneAndUpdate()`

#### Available options

[Available options](#available-options)


new: bool - if true, return the modified document rather than the original. defaults to false (changed in 4.0)upsert: bool - creates the object if it doesn't exist. defaults to false.fields: {Object|String} - Field selection. Equivalent to.select(fields).findOneAndUpdate()sort: if multiple docs are found by the conditions, sets the sort order to choose which doc to updatemaxTimeMS: puts a time limit on the query - requires mongodb >= 2.6.0runValidators: if true, runsupdate validatorson this command. Update validators validate the update operation against the model's schema.setDefaultsOnInsert:trueby default. IfsetDefaultsOnInsertandupsertare true, mongoose will apply thedefaultsspecified in the model's schema if a new document is created.

- new: bool - if true, return the modified document rather than the original. defaults to false (changed in 4.0)

`new`
- upsert: bool - creates the object if it doesn't exist. defaults to false.

`upsert`
- fields: {Object|String} - Field selection. Equivalent to.select(fields).findOneAndUpdate()

`fields`
`.select(fields).findOneAndUpdate()`
- sort: if multiple docs are found by the conditions, sets the sort order to choose which doc to update

`sort`
- maxTimeMS: puts a time limit on the query - requires mongodb >= 2.6.0

`maxTimeMS`
- runValidators: if true, runsupdate validatorson this command. Update validators validate the update operation against the model's schema.

`runValidators`
- setDefaultsOnInsert:trueby default. IfsetDefaultsOnInsertandupsertare true, mongoose will apply thedefaultsspecified in the model's schema if a new document is created.

`setDefaultsOnInsert`
`true`
`setDefaultsOnInsert`
`upsert`

#### Example:

[Example:](#example)


```javascript
query.findOneAndUpdate(conditions, update, options)// returns Queryquery.findOneAndUpdate(conditions, update)// returns Queryquery.findOneAndUpdate(update)// returns Queryquery.findOneAndUpdate()// returns Query
```


### Query.prototype.geometry()

[Query.prototype.geometry()](#Query.prototype.geometry())

`Query.prototype.geometry()`

object«Object»Must contain atypeproperty which is a String and acoordinatesproperty which is an Array. See the examples.

- object«Object»Must contain atypeproperty which is a String and acoordinatesproperty which is an Array. See the examples.

`object`
`type`
`coordinates`

«Query»this

- «Query»this


$geometryGeospatial Support EnhancementsMongoDB Geospatial Indexing

- $geometry

[$geometry](https://www.mongodb.com/docs/manual/reference/operator/geometry/)

- Geospatial Support Enhancements

[Geospatial Support Enhancements](https://www.mongodb.com/docs/manual/release-notes/2.4/#geospatial-support-enhancements)

- MongoDB Geospatial Indexing

[MongoDB Geospatial Indexing](https://www.mongodb.com/docs/manual/core/geospatial-indexes/)


Specifies a$geometrycondition

`$geometry`

#### Example:

[Example:](#example)


```javascript
constpolyA = [[[10,20], [10,40], [30,40], [30,20]]]
query.where('loc').within().geometry({type:'Polygon',coordinates: polyA })// orconstpolyB = [[0,0], [1,1]]
query.where('loc').within().geometry({type:'LineString',coordinates: polyB })// orconstpolyC = [0,0]
query.where('loc').within().geometry({type:'Point',coordinates: polyC })// orquery.where('loc').intersects().geometry({type:'Point',coordinates: polyC })
```


The argument is assigned to the most recent path passed towhere().

`where()`

#### Note:

[Note:](#note)


geometry()mustcome after eitherintersects()orwithin().

`geometry()`
`intersects()`
`within()`

Theobjectargument must containtypeandcoordinatesproperties.

`object`
`type`
`coordinates`

type {String}coordinates {Array}

- type {String}

- coordinates {Array}


### Query.prototype.get()

[Query.prototype.get()](#Query.prototype.get())

`Query.prototype.get()`

path«String|Object»path or object of key/value pairs to get

- path«String|Object»path or object of key/value pairs to get

`path`

«Query»this

- «Query»this


For update operations, returns the value of a path in the update's$set.
Useful for writing getters/setters that can work with both update operations
andsave().

`$set`
`save()`

#### Example:

[Example:](#example)


```javascript
constquery =Model.updateOne({}, {$set: {name:'Jean-Luc Picard'} });
query.get('name');// 'Jean-Luc Picard'
```


### Query.prototype.getFilter()

[Query.prototype.getFilter()](#Query.prototype.getFilter())

`Query.prototype.getFilter()`

«Object»current query filter

- «Object»current query filter


Returns the current query filter (also known as conditions) as aPOJO.

[POJO](https://masteringjs.io/tutorials/fundamentals/pojo)


#### Example:

[Example:](#example)


```javascript
constquery =newQuery();
query.find({a:1}).where('b').gt(2);
query.getFilter();// { a: 1, b: { $gt: 2 } }
```


### Query.prototype.getOptions()

[Query.prototype.getOptions()](#Query.prototype.getOptions())

`Query.prototype.getOptions()`

«Object»the options

- «Object»the options


Gets query options.


#### Example:

[Example:](#example)


```javascript
constquery =newQuery();
query.limit(10);
query.setOptions({maxTimeMS:1000});
query.getOptions();// { limit: 10, maxTimeMS: 1000 }
```


### Query.prototype.getPopulatedPaths()

[Query.prototype.getPopulatedPaths()](#Query.prototype.getPopulatedPaths())

`Query.prototype.getPopulatedPaths()`

«Array»an array of strings representing populated paths

- «Array»an array of strings representing populated paths


Gets a list of paths to be populated by this query


#### Example:

[Example:](#example)


```javascript
bookSchema.pre('findOne',function() {letkeys =this.getPopulatedPaths();// ['author']});
 ...Book.findOne({}).populate('author');
```


#### Example:

[Example:](#example)


```javascript
// Deep populateconstq =L1.find().populate({path:'level2',populate: {path:'level3'}
 });
 q.getPopulatedPaths();// ['level2', 'level2.level3']
```


### Query.prototype.getQuery()

[Query.prototype.getQuery()](#Query.prototype.getQuery())

`Query.prototype.getQuery()`

«Object»current query filter

- «Object»current query filter


Returns the current query filter. Equivalent togetFilter().

`getFilter()`

You should usegetFilter()instead ofgetQuery()where possible.getQuery()will likely be deprecated in a future release.

`getFilter()`
`getQuery()`
`getQuery()`

#### Example:

[Example:](#example)


```javascript
constquery =newQuery();
query.find({a:1}).where('b').gt(2);
query.getQuery();// { a: 1, b: { $gt: 2 } }
```


### Query.prototype.getUpdate()

[Query.prototype.getUpdate()](#Query.prototype.getUpdate())

`Query.prototype.getUpdate()`

«Object»current update operations

- «Object»current update operations


Returns the current update operations as a JSON object.


#### Example:

[Example:](#example)


```javascript
constquery =newQuery();
query.updateOne({}, {$set: {a:5} });
query.getUpdate();// { $set: { a: 5 } }
```


### Query.prototype.gt()

[Query.prototype.gt()](#Query.prototype.gt())

`Query.prototype.gt()`

[path]«String»val«Number»

- [path]«String»

`[path]`
- val«Number»

`val`

$gt

- $gt

[$gt](https://www.mongodb.com/docs/manual/reference/operator/gt/)


Specifies a$gtquery condition.

`$gt`

When called with one argument, the most recent path passed towhere()is used.

`where()`

#### Example:

[Example:](#example)


```javascript
Thing.find().where('age').gt(21);// orThing.find().gt('age',21);
```


### Query.prototype.gte()

[Query.prototype.gte()](#Query.prototype.gte())

`Query.prototype.gte()`

[path]«String»val«Number»

- [path]«String»

`[path]`
- val«Number»

`val`

$gte

- $gte

[$gte](https://www.mongodb.com/docs/manual/reference/operator/gte/)


Specifies a$gtequery condition.

`$gte`

When called with one argument, the most recent path passed towhere()is used.

`where()`

### Query.prototype.hint()

[Query.prototype.hint()](#Query.prototype.hint())

`Query.prototype.hint()`

val«Object»a hint object

- val«Object»a hint object

`val`

«Query»this

- «Query»this


$hint

- $hint

[$hint](https://www.mongodb.com/docs/manual/reference/operator/hint/)


Sets query hints.


#### Example:

[Example:](#example)


```javascript
query.hint({indexA:1,indexB: -1});
```


#### Note:

[Note:](#note)


Cannot be used withdistinct()

`distinct()`

### Query.prototype.in()

[Query.prototype.in()](#Query.prototype.in())

`Query.prototype.in()`

[path]«String»val«Array»

- [path]«String»

`[path]`
- val«Array»

`val`

$in

- $in

[$in](https://www.mongodb.com/docs/manual/reference/operator/in/)


Specifies an$inquery condition.

`$in`

When called with one argument, the most recent path passed towhere()is used.

`where()`

### Query.prototype.intersects()

[Query.prototype.intersects()](#Query.prototype.intersects())

`Query.prototype.intersects()`

[arg]«Object»

- [arg]«Object»

`[arg]`

«Query»this

- «Query»this


$geometrygeoIntersects

- $geometry

[$geometry](https://www.mongodb.com/docs/manual/reference/operator/geometry/)

- geoIntersects

[geoIntersects](https://www.mongodb.com/docs/manual/reference/operator/geoIntersects/)


Declares an intersects query forgeometry().

`geometry()`

#### Example:

[Example:](#example)


```javascript
query.where('path').intersects().geometry({type:'LineString',coordinates: [[180.0,11.0], [180,9.0]]
});

query.where('path').intersects({type:'LineString',coordinates: [[180.0,11.0], [180,9.0]]
});
```


#### Note:

[Note:](#note)


MUSTbe used afterwhere().

`where()`

#### Note:

[Note:](#note)


In Mongoose 3.7,intersectschanged from a getter to a function. If you need the old syntax, usethis.

`intersects`
[this](https://github.com/ebensing/mongoose-within)


### Query.prototype.isPathSelectedInclusive()

[Query.prototype.isPathSelectedInclusive()](#Query.prototype.isPathSelectedInclusive())

`Query.prototype.isPathSelectedInclusive()`

path«String»

- path«String»

`path`

«Boolean»

- «Boolean»


Wrapper function to call isPathSelectedInclusive on a query.


### Query.prototype.j()

[Query.prototype.j()](#Query.prototype.j())

`Query.prototype.j()`

val«boolean»

- val«boolean»

`val`

«Query»this

- «Query»this


mongodb

- mongodb

[mongodb](https://www.mongodb.com/docs/manual/reference/write-concern/#j-option)


Requests acknowledgement that this operation has been persisted to MongoDB's
on-disk journal.
This option is only valid for operations that write to the database:


deleteOne()deleteMany()findOneAndDelete()findOneAndReplace()findOneAndUpdate()updateOne()updateMany()

- deleteOne()

`deleteOne()`
- deleteMany()

`deleteMany()`
- findOneAndDelete()

`findOneAndDelete()`
- findOneAndReplace()

`findOneAndReplace()`
- findOneAndUpdate()

`findOneAndUpdate()`
- updateOne()

`updateOne()`
- updateMany()

`updateMany()`

Defaults to the schema'swriteConcern.joption

[writeConcern.joption](/docs/guide.html#writeConcern)

`writeConcern.j`

#### Example:

[Example:](#example)


```javascript
awaitmongoose.model('Person').deleteOne({name:'Ned Stark'}).j(true);
```


### Query.prototype.lean()

[Query.prototype.lean()](#Query.prototype.lean())

`Query.prototype.lean()`

bool«Boolean|Object»defaults to true

- bool«Boolean|Object»defaults to true

`bool`

«Query»this

- «Query»this


Sets the lean option.


Documents returned from queries with theleanoption enabled are plain
javascript objects, notMongoose Documents. They have nosavemethod, getters/setters, virtuals, or other Mongoose features.

`lean`
[Mongoose Documents](/docs/api/document.html)

`save`

#### Example:

[Example:](#example)


```javascript
newQuery().lean()// truenewQuery().lean(true)newQuery().lean(false)constdocs =awaitModel.find().lean();
docs[0]instanceofmongoose.Document;// false
```


Lean is great for high-performance, read-only cases,
especially when combined
withcursors.

[Lean is great for high-performance, read-only cases](/docs/tutorials/lean.html)

[cursors](/docs/queries.html#streaming)


If you need virtuals, getters/setters, or defaults withlean(), you need
to use a plugin. See:

`lean()`

mongoose-lean-virtualsmongoose-lean-gettersmongoose-lean-defaults

- mongoose-lean-virtuals

- mongoose-lean-getters

- mongoose-lean-defaults


### Query.prototype.limit()

[Query.prototype.limit()](#Query.prototype.limit())

`Query.prototype.limit()`

val«Number»

- val«Number»

`val`

Specifies the maximum number of documents the query will return.


#### Example:

[Example:](#example)


```javascript
query.limit(20);
```


#### Note:

[Note:](#note)


Cannot be used withdistinct()

`distinct()`

### Query.prototype.lt()

[Query.prototype.lt()](#Query.prototype.lt())

`Query.prototype.lt()`

[path]«String»val«Number»

- [path]«String»

`[path]`
- val«Number»

`val`

$lt

- $lt

[$lt](https://www.mongodb.com/docs/manual/reference/operator/lt/)


Specifies a$ltquery condition.

`$lt`

When called with one argument, the most recent path passed towhere()is used.

`where()`

### Query.prototype.lte()

[Query.prototype.lte()](#Query.prototype.lte())

`Query.prototype.lte()`

[path]«String»val«Number»

- [path]«String»

`[path]`
- val«Number»

`val`

$lte

- $lte

[$lte](https://www.mongodb.com/docs/manual/reference/operator/lte/)


Specifies a$ltequery condition.

`$lte`

When called with one argument, the most recent path passed towhere()is used.

`where()`

### Query.prototype.maxDistance()

[Query.prototype.maxDistance()](#Query.prototype.maxDistance())

`Query.prototype.maxDistance()`

[path]«String»val«Number»

- [path]«String»

`[path]`
- val«Number»

`val`

$maxDistance

- $maxDistance

[$maxDistance](https://www.mongodb.com/docs/manual/reference/operator/maxDistance/)


Specifies amaxDistancequery condition.

`maxDistance`

When called with one argument, the most recent path passed towhere()is used.

`where()`

### Query.prototype.maxTimeMS()

[Query.prototype.maxTimeMS()](#Query.prototype.maxTimeMS())

`Query.prototype.maxTimeMS()`

[ms]«Number»The number of milliseconds

- [ms]«Number»The number of milliseconds

`[ms]`

«Query»this

- «Query»this


Sets themaxTimeMSoption. This will tell the MongoDB server to abort if the query or write op
has been running for more thanmsmilliseconds.

[maxTimeMS](https://www.mongodb.com/docs/manual/reference/method/cursor.maxTimeMS/)

`ms`

Callingquery.maxTimeMS(v)is equivalent toquery.setOptions({ maxTimeMS: v })

`query.maxTimeMS(v)`
`query.setOptions({ maxTimeMS: v })`

#### Example:

[Example:](#example)


```javascript
constquery =newQuery();// Throws an error 'operation exceeded time limit' as long as there's// >= 1 doc in the queried collectionconstres =awaitquery.find({$where:'sleep(1000) || true'}).maxTimeMS(100);
```


### Query.prototype.merge()

[Query.prototype.merge()](#Query.prototype.merge())

`Query.prototype.merge()`

source«Query|Object»

- source«Query|Object»

`source`

«Query»this

- «Query»this


Merges another Query or conditions object into this one.


When a Query is passed, conditions, field selection and options are merged.


### Query.prototype.mod()

[Query.prototype.mod()](#Query.prototype.mod())

`Query.prototype.mod()`

[path]«String»val«Array»must be of length 2, first element isdivisor, 2nd element isremainder.

- [path]«String»

`[path]`
- val«Array»must be of length 2, first element isdivisor, 2nd element isremainder.

`val`
`divisor`
`remainder`

«Query»this

- «Query»this


$mod

- $mod

[$mod](https://www.mongodb.com/docs/manual/reference/operator/mod/)


Specifies a$modcondition, filters documents for documents whosepathproperty is a number that is equal toremaindermodulodivisor.

`$mod`
`path`
`remainder`
`divisor`

#### Example:

[Example:](#example)


```javascript
// All find products whose inventory is oddProduct.find().mod('inventory', [2,1]);Product.find().where('inventory').mod([2,1]);// This syntax is a little strange, but supported.Product.find().where('inventory').mod(2,1);
```


### Query.prototype.model

[Query.prototype.model](#Query.prototype.model)

`Query.prototype.model`

«property»

- «property»


The model this query is associated with.


#### Example:

[Example:](#example)


```javascript
constq =MyModel.find();
q.model===MyModel;// true
```


### Query.prototype.mongooseOptions()

[Query.prototype.mongooseOptions()](#Query.prototype.mongooseOptions())

`Query.prototype.mongooseOptions()`

options«Object»if specified, overwrites the current options

- options«Object»if specified, overwrites the current options

`options`

«Object»the options

- «Object»the options


Getter/setter around the current mongoose-specific options for this query
Below are the current Mongoose-specific options.


populate: an array representing what paths will be populated. Should have one entry for each call toQuery.prototype.populate()lean: if truthy, Mongoose will nothydrateany documents that are returned from this query. SeeQuery.prototype.lean()for more information.strict: controls how Mongoose handles keys that aren't in the schema for updates. This option istrueby default, which means Mongoose will silently strip any paths in the update that aren't in the schema. See thestrictmode docsfor more information.strictQuery: controls how Mongoose handles keys that aren't in the schema for the queryfilter. This option isfalseby default, which means Mongoose will allowModel.find({ foo: 'bar' })even iffoois not in the schema. See thestrictQuerydocsfor more information.nearSphere: use$nearSphereinstead ofnear(). See theQuery.prototype.nearSphere()docsschemaLevelProjections: iffalse, Mongoose will not apply schema-levelselect: falseorselect: truefor this query

- populate: an array representing what paths will be populated. Should have one entry for each call toQuery.prototype.populate()

`populate`
`Query.prototype.populate()`
- lean: if truthy, Mongoose will nothydrateany documents that are returned from this query. SeeQuery.prototype.lean()for more information.

`lean`
`Query.prototype.lean()`
- strict: controls how Mongoose handles keys that aren't in the schema for updates. This option istrueby default, which means Mongoose will silently strip any paths in the update that aren't in the schema. See thestrictmode docsfor more information.

`strict`
`true`
`strict`
- strictQuery: controls how Mongoose handles keys that aren't in the schema for the queryfilter. This option isfalseby default, which means Mongoose will allowModel.find({ foo: 'bar' })even iffoois not in the schema. See thestrictQuerydocsfor more information.

`strictQuery`
`filter`
`false`
`Model.find({ foo: 'bar' })`
`foo`
`strictQuery`
- nearSphere: use$nearSphereinstead ofnear(). See theQuery.prototype.nearSphere()docs

`nearSphere`
`$nearSphere`
`near()`
`Query.prototype.nearSphere()`
- schemaLevelProjections: iffalse, Mongoose will not apply schema-levelselect: falseorselect: truefor this query

`schemaLevelProjections`
`false`
`select: false`
`select: true`

Mongoose maintains a separate object for internal options because
Mongoose sendsQuery.prototype.optionsto the MongoDB server, and the
above options are not relevant for the MongoDB server.

`Query.prototype.options`

### Query.prototype.ne()

[Query.prototype.ne()](#Query.prototype.ne())

`Query.prototype.ne()`

[path]«String»val«any»

- [path]«String»

`[path]`
- val«any»

`val`

$ne

- $ne

[$ne](https://www.mongodb.com/docs/manual/reference/operator/ne/)


Specifies a$nequery condition.

`$ne`

When called with one argument, the most recent path passed towhere()is used.

`where()`

### Query.prototype.near()

[Query.prototype.near()](#Query.prototype.near())

`Query.prototype.near()`

[path]«String»val«Object»

- [path]«String»

`[path]`
- val«Object»

`val`

«Query»this

- «Query»this


$near$nearSphere$maxDistanceMongoDB Geospatial Indexing

- $near

[$near](https://www.mongodb.com/docs/manual/reference/operator/near/)

- $nearSphere

[$nearSphere](https://www.mongodb.com/docs/manual/reference/operator/nearSphere/)

- $maxDistance

[$maxDistance](https://www.mongodb.com/docs/manual/reference/operator/maxDistance/)

- MongoDB Geospatial Indexing

[MongoDB Geospatial Indexing](https://www.mongodb.com/docs/manual/core/geospatial-indexes/)


Specifies a$nearor$nearSpherecondition

`$near`
`$nearSphere`

These operators return documents sorted by distance.


#### Example:

[Example:](#example)


```javascript
query.where('loc').near({center: [10,10] });
query.where('loc').near({center: [10,10],maxDistance:5});
query.where('loc').near({center: [10,10],maxDistance:5,spherical:true});
query.near('loc', {center: [10,10],maxDistance:5});
```


### Query.prototype.nearSphere()

[Query.prototype.nearSphere()](#Query.prototype.nearSphere())

`Query.prototype.nearSphere()`

near()$near$nearSphere$maxDistance

- near()

[near()](#Query.prototype.near())

- $near

[$near](https://www.mongodb.com/docs/manual/reference/operator/near/)

- $nearSphere

[$nearSphere](https://www.mongodb.com/docs/manual/reference/operator/nearSphere/)

- $maxDistance

[$maxDistance](https://www.mongodb.com/docs/manual/reference/operator/maxDistance/)


DEPRECATEDSpecifies a$nearSpherecondition

`$nearSphere`

#### Example:

[Example:](#example)


```javascript
query.where('loc').nearSphere({center: [10,10],maxDistance:5});
```


Deprecated.Usequery.near()instead with thesphericaloption set totrue.

`query.near()`
`spherical`
`true`

#### Example:

[Example:](#example)


```javascript
query.where('loc').near({center: [10,10],spherical:true});
```


### Query.prototype.nin()

[Query.prototype.nin()](#Query.prototype.nin())

`Query.prototype.nin()`

[path]«String»val«Array»

- [path]«String»

`[path]`
- val«Array»

`val`

$nin

- $nin

[$nin](https://www.mongodb.com/docs/manual/reference/operator/nin/)


Specifies an$ninquery condition.

`$nin`

When called with one argument, the most recent path passed towhere()is used.

`where()`

### Query.prototype.nor()

[Query.prototype.nor()](#Query.prototype.nor())

`Query.prototype.nor()`

array«Array»array of conditions

- array«Array»array of conditions

`array`

«Query»this

- «Query»this


$nor

- $nor

[$nor](https://www.mongodb.com/docs/manual/reference/operator/nor/)


Specifies arguments for a$norcondition.

`$nor`

#### Example:

[Example:](#example)


```javascript
query.nor([{color:'green'}, {status:'ok'}]);
```


### Query.prototype.or()

[Query.prototype.or()](#Query.prototype.or())

`Query.prototype.or()`

array«Array»array of conditions

- array«Array»array of conditions

`array`

«Query»this

- «Query»this


$or

- $or

[$or](https://www.mongodb.com/docs/manual/reference/operator/or/)


Specifies arguments for an$orcondition.

`$or`

#### Example:

[Example:](#example)


```javascript
query.or([{color:'red'}, {status:'emergency'}]);
```


### Query.prototype.orFail()

[Query.prototype.orFail()](#Query.prototype.orFail())

`Query.prototype.orFail()`

[err]«Function|Error»optional error to throw if no docs matchfilter. If not specified,orFail()will throw aDocumentNotFoundError

- [err]«Function|Error»optional error to throw if no docs matchfilter. If not specified,orFail()will throw aDocumentNotFoundError

`[err]`
`filter`
`orFail()`
`DocumentNotFoundError`

«Query»this

- «Query»this


Make this query throw an error if no documents match the givenfilter.
This is handy for integrating with async/await, becauseorFail()saves you
an extraifstatement to check if no document was found.

`filter`
`orFail()`
`if`

#### Example:

[Example:](#example)


```javascript
// Throws if no doc returnedawaitModel.findOne({foo:'bar'}).orFail();// Throws if no document was updated. Note that `orFail()` will still// throw if the only document that matches is `{ foo: 'bar', name: 'test' }`,// because `orFail()` will throw if no document was _updated_, not// if no document was _found_.awaitModel.updateOne({foo:'bar'}, {name:'test'}).orFail();// Throws "No docs found!" error if no docs match `{ foo: 'bar' }`awaitModel.find({foo:'bar'}).orFail(newError('No docs found!'));// Throws "Not found" error if no document was foundawaitModel.findOneAndUpdate({foo:'bar'}, {name:'test'}).orFail(() =>Error('Not found'));
```


### Query.prototype.polygon()

[Query.prototype.polygon()](#Query.prototype.polygon())

`Query.prototype.polygon()`

[path]«String|Array»[...coordinatePairs]«Array|Object»

- [path]«String|Array»

`[path]`
- [...coordinatePairs]«Array|Object»

`[...coordinatePairs]`

«Query»this

- «Query»this


$polygonMongoDB Geospatial Indexing

- $polygon

[$polygon](https://www.mongodb.com/docs/manual/reference/operator/polygon/)

- MongoDB Geospatial Indexing

[MongoDB Geospatial Indexing](https://www.mongodb.com/docs/manual/core/geospatial-indexes/)


Specifies a$polygoncondition

`$polygon`

#### Example:

[Example:](#example)


```javascript
query.where('loc').within().polygon([10,20], [13,25], [7,15]);
query.polygon('loc', [10,20], [13,25], [7,15]);
```


### Query.prototype.populate()

[Query.prototype.populate()](#Query.prototype.populate())

`Query.prototype.populate()`

path«Object|String|Array[String]»either the path(s) to populate or an object specifying all parameters[select]«Object|String»Field selection for the population query[model]«Model»The model you wish to use for population. If not specified, populate will look up the model by the name in the Schema'sreffield.[match]«Object»Conditions for the population query[options]«Object»Options for the population query (sort, etc)[options.path=null]«String»The path to populate.[options.retainNullValues=false]«boolean»by default, Mongoose removes null and undefined values from populated arrays. Use this option to makepopulate()retainnullandundefinedarray entries.[options.getters=false]«boolean»if true, Mongoose will call any getters defined on thelocalField. By default, Mongoose gets the raw value oflocalField. For example, you would need to set this option totrueif you wanted toadd alowercasegetter to yourlocalField.[options.clone=false]«boolean»When you doBlogPost.find().populate('author'), blog posts with the same author will share 1 copy of anauthordoc. Enable this option to make Mongoose clone populated docs before assigning them.[options.match=null]«Object|Function»Add an additional filter to the populate query. Can be a filter object containingMongoDB query syntax, or a function that returns a filter object.[options.transform=null]«Function»Function that Mongoose will call on every populated document that allows you to transform the populated document.[options.options=null]«Object»Additional options likelimitandlean.

- path«Object|String|Array[String]»either the path(s) to populate or an object specifying all parameters

`path`
- [select]«Object|String»Field selection for the population query

`[select]`
- [model]«Model»The model you wish to use for population. If not specified, populate will look up the model by the name in the Schema'sreffield.

`[model]`
`ref`
- [match]«Object»Conditions for the population query

`[match]`
- [options]«Object»Options for the population query (sort, etc)

`[options]`

[options.path=null]«String»The path to populate.

- [options.path=null]«String»The path to populate.

`[options.path=null]`

[options.retainNullValues=false]«boolean»by default, Mongoose removes null and undefined values from populated arrays. Use this option to makepopulate()retainnullandundefinedarray entries.

- [options.retainNullValues=false]«boolean»by default, Mongoose removes null and undefined values from populated arrays. Use this option to makepopulate()retainnullandundefinedarray entries.

`[options.retainNullValues=false]`
`populate()`
`null`
`undefined`

[options.getters=false]«boolean»if true, Mongoose will call any getters defined on thelocalField. By default, Mongoose gets the raw value oflocalField. For example, you would need to set this option totrueif you wanted toadd alowercasegetter to yourlocalField.

- [options.getters=false]«boolean»if true, Mongoose will call any getters defined on thelocalField. By default, Mongoose gets the raw value oflocalField. For example, you would need to set this option totrueif you wanted toadd alowercasegetter to yourlocalField.

`[options.getters=false]`
`localField`
`localField`
`true`
`lowercase`
`localField`

[options.clone=false]«boolean»When you doBlogPost.find().populate('author'), blog posts with the same author will share 1 copy of anauthordoc. Enable this option to make Mongoose clone populated docs before assigning them.

- [options.clone=false]«boolean»When you doBlogPost.find().populate('author'), blog posts with the same author will share 1 copy of anauthordoc. Enable this option to make Mongoose clone populated docs before assigning them.

`[options.clone=false]`
`BlogPost.find().populate('author')`
`author`

[options.match=null]«Object|Function»Add an additional filter to the populate query. Can be a filter object containingMongoDB query syntax, or a function that returns a filter object.

- [options.match=null]«Object|Function»Add an additional filter to the populate query. Can be a filter object containingMongoDB query syntax, or a function that returns a filter object.

`[options.match=null]`

[options.transform=null]«Function»Function that Mongoose will call on every populated document that allows you to transform the populated document.

- [options.transform=null]«Function»Function that Mongoose will call on every populated document that allows you to transform the populated document.

`[options.transform=null]`

[options.options=null]«Object»Additional options likelimitandlean.

- [options.options=null]«Object»Additional options likelimitandlean.

`[options.options=null]`
`limit`
`lean`

«Query»this

- «Query»this


populationQuery#selectModel.populate

- population

[population](/docs/populate.html)

- Query#select

[Query#select](#Query.prototype.select())

- Model.populate

[Model.populate](/docs/api/model.html#Model.populate())


Specifies paths which should be populated with other documents.


#### Example:

[Example:](#example)


```javascript
letbook =awaitBook.findOne().populate('authors');
book.title;// 'Node.js in Action'book.authors[0].name;// 'TJ Holowaychuk'book.authors[1].name;// 'Nathan Rajlich'letbooks =awaitBook.find().populate({path:'authors',// `match` and `sort` apply to the Author model,// not the Book model. These options do not affect// which documents are in `books`, just the order and// contents of each book document's `authors`.match: {name:newRegExp('.*h.*','i') },sort: {name: -1}
});
books[0].title;// 'Node.js in Action'// Each book's `authors` are sorted by name, descending.books[0].authors[0].name;// 'TJ Holowaychuk'books[0].authors[1].name;// 'Marc Harter'books[1].title;// 'Professional AngularJS'// Empty array, no authors' name has the letter 'h'books[1].authors;// []
```


Paths are populated after the query executes and a response is received. A
separate query is then executed for each path specified for population. After
a response for each query has also been returned, the results are passed to
the callback.


### Query.prototype.post()

[Query.prototype.post()](#Query.prototype.post())

`Query.prototype.post()`

fn«Function»

- fn«Function»

`fn`

«Promise»

- «Promise»


Add postmiddlewareto this query instance. Doesn't affect
other queries.

[middleware](/docs/middleware.html)


#### Example:

[Example:](#example)


```javascript
constq1 =Question.find({answer:42});
q1.post(functionmiddleware() {console.log(this.getFilter());
});awaitq1.exec();// Prints "{ answer: 42 }"// Doesn't print anything, because `middleware()` is only// registered on `q1`.awaitQuestion.find({answer:42});
```


### Query.prototype.pre()

[Query.prototype.pre()](#Query.prototype.pre())

`Query.prototype.pre()`

fn«Function»

- fn«Function»

`fn`

«Promise»

- «Promise»


Add premiddlewareto this query instance. Doesn't affect
other queries.

[middleware](/docs/middleware.html)


#### Example:

[Example:](#example)


```javascript
constq1 =Question.find({answer:42});
q1.pre(functionmiddleware() {console.log(this.getFilter());
});awaitq1.exec();// Prints "{ answer: 42 }"// Doesn't print anything, because `middleware()` is only// registered on `q1`.awaitQuestion.find({answer:42});
```


### Query.prototype.projection()

[Query.prototype.projection()](#Query.prototype.projection())

`Query.prototype.projection()`

arg«Object|null»

- arg«Object|null»

`arg`

«Object»the current projection

- «Object»the current projection


Get/set the current projection (AKA fields). Passnullto remove the
current projection.

`null`

Unlikeprojection(), theselect()function modifies the current
projection in place. This function overwrites the existing projection.

`projection()`
`select()`

#### Example:

[Example:](#example)


```javascript
constq =Model.find();
q.projection();// nullq.select('a b');
q.projection();// { a: 1, b: 1 }q.projection({c:1});
q.projection();// { c: 1 }q.projection(null);
q.projection();// null
```


### Query.prototype.read()

[Query.prototype.read()](#Query.prototype.read())

`Query.prototype.read()`

mode«String»one of the listed preference options or aliases[tags]«Array»optional tags for this query

- mode«String»one of the listed preference options or aliases

`mode`
- [tags]«Array»optional tags for this query

`[tags]`

«Query»this

- «Query»this


mongodb

- mongodb

[mongodb](https://www.mongodb.com/docs/manual/applications/replication/#read-preference)


Determines the MongoDB nodes from which to read.


#### Preferences:

[Preferences:](#preferences)


```javascript
primary - (default)Readfromprimary only.Operationswill produce an errorifprimary is unavailable.Cannotbe combinedwithtags.
secondaryReadfromsecondaryifavailable, otherwise error.
primaryPreferredReadfromprimaryifavailable, otherwise a secondary.
secondaryPreferredReadfroma secondaryifavailable, otherwise readfromthe primary.
nearestAlloperations readfromamong the nearest candidates, but unlike other modes,thisoption will include both the primary and all secondariesinthe random selection.
```


Aliases


```javascript
p   primary
pp  primaryPreferred
s   secondary
sp  secondaryPreferred
n   nearest
```


#### Example:

[Example:](#example)


```javascript
newQuery().read('primary')newQuery().read('p')// same as primarynewQuery().read('primaryPreferred')newQuery().read('pp')// same as primaryPreferrednewQuery().read('secondary')newQuery().read('s')// same as secondarynewQuery().read('secondaryPreferred')newQuery().read('sp')// same as secondaryPreferrednewQuery().read('nearest')newQuery().read('n')// same as nearest// read from secondaries with matching tagsnewQuery().read('s', [{dc:'sf',s:1},{dc:'ma',s:2}])
```


Read more about how to use read preferenceshere.

[here](https://www.mongodb.com/docs/manual/applications/replication/#read-preference)


### Query.prototype.readConcern()

[Query.prototype.readConcern()](#Query.prototype.readConcern())

`Query.prototype.readConcern()`

level«String»one of the listed read concern level or their aliases

- level«String»one of the listed read concern level or their aliases

`level`

«Query»this

- «Query»this


mongodb

- mongodb

[mongodb](https://www.mongodb.com/docs/manual/reference/read-concern/)


Sets the readConcern option for the query.


#### Example:

[Example:](#example)


```javascript
newQuery().readConcern('local')newQuery().readConcern('l')// same as localnewQuery().readConcern('available')newQuery().readConcern('a')// same as availablenewQuery().readConcern('majority')newQuery().readConcern('m')// same as majoritynewQuery().readConcern('linearizable')newQuery().readConcern('lz')// same as linearizablenewQuery().readConcern('snapshot')newQuery().readConcern('s')// same as snapshot
```


#### Read Concern Level:

[Read Concern Level:](#read-concern-level)


```javascript
localMongoDB3.2+Thequery returnsfromthe instancewithno guarantee guarantee that the data has been written to a majorityofthe replica setmembers(i.e. may be rolled back).
availableMongoDB3.6+Thequery returnsfromthe instancewithno guarantee guarantee that the data has been written to a majorityofthe replica setmembers(i.e. may be rolled back).
majorityMongoDB3.2+Thequery returns the data that has been acknowledged by a majorityofthe replica set members.Thedocuments returned by the read operation are durable, eveninthe eventoffailure.
linearizableMongoDB3.4+Thequery returns data that reflects all successful majority-acknowledged writes that completed prior to the startofthe read operation.Thequery may waitforconcurrently executing writes to propagate to a majorityofreplica set members before returning results.
snapshotMongoDB4.0+Onlyavailableforoperations within multi-documenttransactions.Upontransaction commitwithwrite concern"majority", the transaction operations are guaranteed to have readfroma snapshotofmajority-committed data.
```


Aliases


```javascript
l   local
a   available
m   majority
lz  linearizable
s   snapshot
```


Read more about how to use read concernhere.

[here](https://www.mongodb.com/docs/manual/reference/read-concern/)


### Query.prototype.regex()

[Query.prototype.regex()](#Query.prototype.regex())

`Query.prototype.regex()`

[path]«String»val«String|RegExp»

- [path]«String»

`[path]`
- val«String|RegExp»

`val`

$regex

- $regex

[$regex](https://www.mongodb.com/docs/manual/reference/operator/regex/)


Specifies a$regexquery condition.

`$regex`

When called with one argument, the most recent path passed towhere()is used.

`where()`

### Query.prototype.replaceOne()

[Query.prototype.replaceOne()](#Query.prototype.replaceOne())

`Query.prototype.replaceOne()`

[filter]«Object»[doc]«Object»the update command[options]«Object»[options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.[options.strict]«Boolean|String»overwrites the schema'sstrict mode option[options.upsert=false]«Boolean»if true, and no documents found, insert a new document[options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.[callback]«Function»params are (error, writeOpResult)

- [filter]«Object»

`[filter]`
- [doc]«Object»the update command

`[doc]`
- [options]«Object»

`[options]`

[options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.

- [options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.

`[options.multipleCastError]`

[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [options.strict]«Boolean|String»overwrites the schema'sstrict mode option

`[options.strict]`

[options.upsert=false]«Boolean»if true, and no documents found, insert a new document

- [options.upsert=false]«Boolean»if true, and no documents found, insert a new document

`[options.upsert=false]`

[options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern

- [options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern

`[options.writeConcern=null]`

[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.

- [options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.

`[options.timestamps=null]`
`false`

[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

- [options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

`[options.translateAliases=null]`
`true`
`filter`
`projection`
`update`
`distinct`
- [callback]«Function»params are (error, writeOpResult)

`[callback]`

«Query»this

- «Query»this


Model.updateQuery docsupdateUpdateResultMongoDB docs

- Model.update

[Model.update](/docs/api/model.html#Model.update())

- Query docs

[Query docs](/docs/queries.html)

- update

[update](https://www.mongodb.com/docs/manual/reference/method/db.collection.update/)

- UpdateResult

[UpdateResult](https://mongodb.github.io/node-mongodb-native/4.9/interfaces/UpdateResult.html)

- MongoDB docs

[MongoDB docs](https://www.mongodb.com/docs/manual/reference/command/update/#update-command-output)


Declare and/or execute this query as a replaceOne() operation.
MongoDB will replace the existing document and will not accept anyatomic operators($set, etc.)

[atomic operators](https://www.mongodb.com/docs/manual/tutorial/model-data-for-atomic-operations/#pattern)

`$set`

NotereplaceOne willnotfire update middleware. Usepre('replaceOne')andpost('replaceOne')instead.

`pre('replaceOne')`
`post('replaceOne')`

#### Example:

[Example:](#example)


```javascript
constres =awaitPerson.replaceOne({_id:24601}, {name:'Jean Valjean'});
res.acknowledged;// Indicates if this write result was acknowledged. If not, then all other members of this result will be undefined.res.matchedCount;// Number of documents that matched the filterres.modifiedCount;// Number of documents that were modifiedres.upsertedCount;// Number of documents that were upsertedres.upsertedId;// Identifier of the inserted document (if an upsert took place)
```


This function triggers the following middleware.


replaceOne()

- replaceOne()

`replaceOne()`

### Query.prototype.sanitizeProjection()

[Query.prototype.sanitizeProjection()](#Query.prototype.sanitizeProjection())

`Query.prototype.sanitizeProjection()`

value«Boolean»

- value«Boolean»

`value`

«Query»this

- «Query»this


sanitizeProjection

- sanitizeProjection

[sanitizeProjection](https://thecodebarbarian.com/whats-new-in-mongoose-5-13-sanitizeprojection.html)


Sets this query'ssanitizeProjectionoption. If set,sanitizeProjectiondoes
two things:

`sanitizeProjection`
`sanitizeProjection`

Enforces that projection values are numbers, not strings.Prevents using+syntax to override properties that are deselected by default.

- Enforces that projection values are numbers, not strings.

- Prevents using+syntax to override properties that are deselected by default.

`+`

WithsanitizeProjection(), you can pass potentially untrusted user data to.select().

`sanitizeProjection()`
`.select()`

#### Example

[Example](#example)


```javascript
constuserSchema =newSchema({name:String,password: {type:String,select:false}
});constUserModel= mongoose.model('User', userSchema);const{ _id } =awaitUserModel.create({name:'John',password:'secret'})// The MongoDB server has special handling for string values that start with '$'// in projections, which can lead to unexpected leaking of sensitive data.letdoc =awaitUserModel.findOne().select({name:'$password'});
doc.name;// 'secret'doc.password;// undefined// With `sanitizeProjection`, Mongoose forces all projection values to be numbersdoc =awaitUserModel.findOne().sanitizeProjection(true).select({name:'$password'});
doc.name;// 'John'doc.password;// undefined// By default, Mongoose supports projecting in `password` using `+password`doc =awaitUserModel.findOne().select('+password');
doc.password;// 'secret'// With `sanitizeProjection`, Mongoose prevents projecting in `password` and other// fields that have `select: false` in the schema.doc =awaitUserModel.findOne().sanitizeProjection(true).select('+password');
doc.password;// undefined
```


### Query.prototype.schemaLevelProjections()

[Query.prototype.schemaLevelProjections()](#Query.prototype.schemaLevelProjections())

`Query.prototype.schemaLevelProjections()`

value«Boolean»

- value«Boolean»

`value`

«Query»this

- «Query»this


SchemaTypeOptions

- SchemaTypeOptions

[SchemaTypeOptions](/docs/schematypes.html#all-schema-types)


Enable or disable schema level projections for this query. Enabled by default.
Set tofalseto include fields withselect: falsein the query result by default.

`false`
`select: false`

#### Example:

[Example:](#example)


```javascript
constuserSchema =newSchema({email: {type:String,required:true},passwordHash: {type:String,select:false,required:true}
});constUserModel= mongoose.model('User', userSchema);constdoc =awaitUserModel.findOne().orFail().schemaLevelProjections(false);// Contains password hash, because `schemaLevelProjections()` overrides `select: false`doc.passwordHash;
```


### Query.prototype.select()

[Query.prototype.select()](#Query.prototype.select())

`Query.prototype.select()`

arg«Object|String|Array[String]»

- arg«Object|String|Array[String]»

`arg`

«Query»this

- «Query»this


SchemaType

- SchemaType

[SchemaType](/docs/api/schematype.html)


Specifies which document fields to include or exclude (also known as the query "projection")


When using string syntax, prefixing a path with-will flag that path as excluded. When a path does not have the-prefix, it is included. Lastly, if a path is prefixed with+, it forces inclusion of the path, which is useful for paths excluded at theschema level.

`-`
`-`
`+`
[schema level](/docs/api/schematype.html#SchemaType.prototype.select())


A projectionmustbe either inclusive or exclusive. In other words, you must
either list the fields to include (which excludes all others), or list the fields
to exclude (which implies all other fields are included). The_idfield is the only exception because MongoDB includes it by default.

[_idfield is the only exception because MongoDB includes it by default](https://www.mongodb.com/docs/manual/tutorial/project-fields-from-query-results/#suppress-id-field)

`_id`

#### Example:

[Example:](#example)


```javascript
// include a and b, exclude other fieldsquery.select('a b');// Equivalent syntaxes:query.select(['a','b']);
query.select({a:1,b:1});// exclude c and d, include other fieldsquery.select('-c -d');// Use `+` to override schema-level `select: false` without making the// projection inclusive.constschema =newSchema({foo: {type:String,select:false},bar:String});// ...query.select('+foo');// Override foo's `select: false` without excluding `bar`// or you may use object notation, useful when// you have keys already prefixed with a "-"query.select({a:1,b:1});
query.select({c:0,d:0});Additionalcalls to select can override the previousselection:
query.select({a:1,b:1}).select({b:0});// selection is now { a: 1 }query.select({a:0,b:0}).select({b:1});// selection is now { a: 0 }
```


### Query.prototype.selected()

[Query.prototype.selected()](#Query.prototype.selected())

`Query.prototype.selected()`

«Boolean»

- «Boolean»


Determines if field selection has been made.


### Query.prototype.selectedExclusively()

[Query.prototype.selectedExclusively()](#Query.prototype.selectedExclusively())

`Query.prototype.selectedExclusively()`

«Boolean»

- «Boolean»


Determines if exclusive field selection has been made.


```javascript
query.selectedExclusively();// falsequery.select('-name');
query.selectedExclusively();// truequery.selectedInclusively();// false
```


### Query.prototype.selectedInclusively()

[Query.prototype.selectedInclusively()](#Query.prototype.selectedInclusively())

`Query.prototype.selectedInclusively()`

«Boolean»

- «Boolean»


Determines if inclusive field selection has been made.


```javascript
query.selectedInclusively();// falsequery.select('name');
query.selectedInclusively();// true
```


### Query.prototype.session()

[Query.prototype.session()](#Query.prototype.session())

`Query.prototype.session()`

[session]«ClientSession»fromawait conn.startSession()

- [session]«ClientSession»fromawait conn.startSession()

`[session]`
`await conn.startSession()`

«Query»this

- «Query»this


Connection.prototype.startSession()mongoose.startSession()

- Connection.prototype.startSession()

[Connection.prototype.startSession()](/docs/api/connection.html#Connection.prototype.startSession())

- mongoose.startSession()

[mongoose.startSession()](/docs/api/mongoose.html#Mongoose.prototype.startSession())


Sets theMongoDB sessionassociated with this query. Sessions are how you mark a query as part of atransaction.

[MongoDB session](https://www.mongodb.com/docs/manual/reference/server-sessions/)

[transaction](/docs/transactions.html)


Callingsession(null)removes the session from this query.

`session(null)`

#### Example:

[Example:](#example)


```javascript
consts =awaitmongoose.startSession();awaitmongoose.model('Person').findOne({name:'Axl Rose'}).session(s);
```


### Query.prototype.set()

[Query.prototype.set()](#Query.prototype.set())

`Query.prototype.set()`

path«String|Object»path or object of key/value pairs to set[val]«Any»the value to set

- path«String|Object»path or object of key/value pairs to set

`path`
- [val]«Any»the value to set

`[val]`

«Query»this

- «Query»this


Adds a$setto this query's update without changing the operation.
This is useful for query middleware so you can add an update regardless
of whether you useupdateOne(),updateMany(),findOneAndUpdate(), etc.

`$set`
`updateOne()`
`updateMany()`
`findOneAndUpdate()`

#### Example:

[Example:](#example)


```javascript
// Updates `{ $set: { updatedAt: new Date() } }`newQuery().updateOne({}, {}).set('updatedAt',newDate());newQuery().updateMany({}, {}).set({updatedAt:newDate() });
```


### Query.prototype.setOptions()

[Query.prototype.setOptions()](#Query.prototype.setOptions())

`Query.prototype.setOptions()`

options«Object»

- options«Object»

`options`

«Query»this

- «Query»this


Sets query options. Some options only make sense for certain operations.


#### Options:

[Options:](#options)


The following options are only forfind():

`find()`

tailablelimitskipallowDiskUsebatchSizereadPreferencehintcomment

- tailable

- limit

- skip

- allowDiskUse

- batchSize

- readPreference

- hint

- comment


The following options are only for write operations:updateOne(),updateMany(),replaceOne(),findOneAndUpdate(), andfindByIdAndUpdate():

`updateOne()`
`updateMany()`
`replaceOne()`
`findOneAndUpdate()`
`findByIdAndUpdate()`

upsertwriteConcerntimestamps: Iftimestampsis set in the schema, set this option tofalseto skip timestamps for that particular update. Has no effect iftimestampsis not enabled in the schema options.overwriteDiscriminatorKey: allow setting the discriminator key in the update. Will use the correct discriminator schema if the update changes the discriminator key.overwriteImmutable: allow overwriting properties that are set toimmutablein the schema. Defaults to false.

- upsert

- writeConcern

- timestamps: Iftimestampsis set in the schema, set this option tofalseto skip timestamps for that particular update. Has no effect iftimestampsis not enabled in the schema options.

`timestamps`
`false`
`timestamps`
- overwriteDiscriminatorKey: allow setting the discriminator key in the update. Will use the correct discriminator schema if the update changes the discriminator key.

- overwriteImmutable: allow overwriting properties that are set toimmutablein the schema. Defaults to false.

`immutable`

The following options are only forfind(),findOne(),findById(),findOneAndUpdate(),findOneAndReplace(),findOneAndDelete(), andfindByIdAndUpdate():

`find()`
`findOne()`
`findById()`
`findOneAndUpdate()`
`findOneAndReplace()`
`findOneAndDelete()`
`findByIdAndUpdate()`

leanpopulateprojectionsanitizeProjectionuseBigInt64

- lean

- populate

- projection

- sanitizeProjection

- useBigInt64


The following options are only for all operationsexceptupdateOne(),updateMany(),deleteOne(), anddeleteMany():

`updateOne()`
`updateMany()`
`deleteOne()`
`deleteMany()`

maxTimeMS

- maxTimeMS


The following options are forfind(),findOne(),findOneAndUpdate(),findOneAndDelete(),updateOne(), anddeleteOne():

`find()`
`findOne()`
`findOneAndUpdate()`
`findOneAndDelete()`
`updateOne()`
`deleteOne()`

sort

- sort


The following options are forfindOneAndUpdate()andfindOneAndDelete()

`findOneAndUpdate()`
`findOneAndDelete()`

includeResultMetadata

- includeResultMetadata


The following options are for all operations:


strictcollationsessionexplain

- strict

- collation

- session

- explain


### Query.prototype.setQuery()

[Query.prototype.setQuery()](#Query.prototype.setQuery())

`Query.prototype.setQuery()`

new«Object»query conditions

- new«Object»query conditions

`new`

«undefined,void»

- «undefined,void»


Sets the query conditions to the provided JSON object.


#### Example:

[Example:](#example)


```javascript
constquery =newQuery();
query.find({a:1})
query.setQuery({a:2});
query.getQuery();// { a: 2 }
```


### Query.prototype.setUpdate()

[Query.prototype.setUpdate()](#Query.prototype.setUpdate())

`Query.prototype.setUpdate()`

new«Object»update operation

- new«Object»update operation

`new`

«undefined,void»

- «undefined,void»


Sets the current update operation to new value.


#### Example:

[Example:](#example)


```javascript
constquery =newQuery();
query.updateOne({}, {$set: {a:5} });
query.setUpdate({$set: {b:6} });
query.getUpdate();// { $set: { b: 6 } }
```


### Query.prototype.size()

[Query.prototype.size()](#Query.prototype.size())

`Query.prototype.size()`

[path]«String»val«Number»

- [path]«String»

`[path]`
- val«Number»

`val`

$size

- $size

[$size](https://www.mongodb.com/docs/manual/reference/operator/size/)


Specifies a$sizequery condition.

`$size`

When called with one argument, the most recent path passed towhere()is used.

`where()`

#### Example:

[Example:](#example)


```javascript
constdocs =awaitMyModel.where('tags').size(0).exec();assert(Array.isArray(docs));console.log('documents with 0 tags', docs);
```


### Query.prototype.skip()

[Query.prototype.skip()](#Query.prototype.skip())

`Query.prototype.skip()`

val«Number»

- val«Number»

`val`

cursor.skip

- cursor.skip

[cursor.skip](https://www.mongodb.com/docs/manual/reference/method/cursor.skip/)


Specifies the number of documents to skip.


#### Example:

[Example:](#example)


```javascript
query.skip(100).limit(20);
```


#### Note:

[Note:](#note)


Cannot be used withdistinct()

`distinct()`

### Query.prototype.slice()

[Query.prototype.slice()](#Query.prototype.slice())

`Query.prototype.slice()`

[path]«String»val«Number|Array»number of elements to slice or array with number of elements to skip and number of elements to slice

- [path]«String»

`[path]`
- val«Number|Array»number of elements to slice or array with number of elements to skip and number of elements to slice

`val`

«Query»this

- «Query»this


mongodb$slice

- mongodb

[mongodb](https://www.mongodb.com/docs/manual/tutorial/query-documents/#projection)

- $slice

[$slice](https://www.mongodb.com/docs/manual/reference/projection/slice/#prj._S_slice)


Specifies a$sliceprojection for an array.

`$slice`

#### Example:

[Example:](#example)


```javascript
query.slice('comments',5);// Returns the first 5 commentsquery.slice('comments', -5);// Returns the last 5 commentsquery.slice('comments', [10,5]);// Returns the first 5 comments after the 10-thquery.where('comments').slice(5);// Returns the first 5 commentsquery.where('comments').slice([-10,5]);// Returns the first 5 comments after the 10-th to last
```


Note:If the absolute value of the number of elements to be sliced is greater than the number of elements in the array, all array elements will be returned.


```javascript
// Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]query.slice('arr',20);// Returns [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]query.slice('arr', -20);// Returns [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
```


Note:If the number of elements to skip is positive and greater than the number of elements in the array, an empty array will be returned.


```javascript
// Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]query.slice('arr', [20,5]);// Returns []
```


Note:If the number of elements to skip is negative and its absolute value is greater than the number of elements in the array, the starting position is the start of the array.


```javascript
// Given `arr`: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]query.slice('arr', [-20,5]);// Returns [1, 2, 3, 4, 5]
```


### Query.prototype.sort()

[Query.prototype.sort()](#Query.prototype.sort())

`Query.prototype.sort()`

arg«Object|String|Array<Array<string|number>>»[options]«Object»[options.override=false]«Boolean»If true, replace existing sort options witharg

- arg«Object|String|Array<Array<string|number>>»

`arg`
- [options]«Object»

`[options]`

[options.override=false]«Boolean»If true, replace existing sort options witharg

- [options.override=false]«Boolean»If true, replace existing sort options witharg

`[options.override=false]`
`arg`

«Query»this

- «Query»this


cursor.sort

- cursor.sort

[cursor.sort](https://www.mongodb.com/docs/manual/reference/method/cursor.sort/)


Sets the sort order


If an object is passed, values allowed areasc,desc,ascending,descending,1, and-1.

`asc`
`desc`
`ascending`
`descending`
`1`
`-1`

If a string is passed, it must be a space delimited list of path names. The
sort order of each path is ascending unless the path name is prefixed with-which will be treated as descending.

`-`

#### Example:

[Example:](#example)


```javascript
// sort by "field" ascending and "test" descendingquery.sort({field:'asc',test: -1});// equivalentquery.sort('field -test');// also possible is to use a array with array key-value pairsquery.sort([['field','asc']]);
```


#### Note:

[Note:](#note)


Cannot be used withdistinct()

`distinct()`

### Query.prototype.tailable()

[Query.prototype.tailable()](#Query.prototype.tailable())

`Query.prototype.tailable()`

bool«Boolean»defaults to true[opts]«Object»options to set[opts.awaitData]«Boolean»false by default. Set to true to keep the cursor open even if there's no data.[opts.maxAwaitTimeMS]«Number»the maximum amount of time for the server to wait on new documents to satisfy a tailable cursor query. RequirestailableandawaitDatato be true

- bool«Boolean»defaults to true

`bool`
- [opts]«Object»options to set

`[opts]`

[opts.awaitData]«Boolean»false by default. Set to true to keep the cursor open even if there's no data.

- [opts.awaitData]«Boolean»false by default. Set to true to keep the cursor open even if there's no data.

`[opts.awaitData]`

[opts.maxAwaitTimeMS]«Number»the maximum amount of time for the server to wait on new documents to satisfy a tailable cursor query. RequirestailableandawaitDatato be true

- [opts.maxAwaitTimeMS]«Number»the maximum amount of time for the server to wait on new documents to satisfy a tailable cursor query. RequirestailableandawaitDatato be true

`[opts.maxAwaitTimeMS]`
`tailable`
`awaitData`

tailable

- tailable

[tailable](https://www.mongodb.com/docs/manual/tutorial/create-tailable-cursor/)


Sets the tailable option (for use with capped collections).


#### Example:

[Example:](#example)


```javascript
query.tailable();// truequery.tailable(true);
query.tailable(false);// Set both `tailable` and `awaitData` optionsquery.tailable({awaitData:true});
```


#### Note:

[Note:](#note)


Cannot be used withdistinct()

`distinct()`

### Query.prototype.then()

[Query.prototype.then()](#Query.prototype.then())

`Query.prototype.then()`

[resolve]«Function»[reject]«Function»

- [resolve]«Function»

`[resolve]`
- [reject]«Function»

`[reject]`

«Promise»

- «Promise»


Executes the query returning aPromisewhich will be
resolved with either the doc(s) or rejected with the error.

`Promise`

More aboutthen()in JavaScript.

[then()in JavaScript](https://masteringjs.io/tutorials/fundamentals/then)

`then()`

### Query.prototype.toConstructor()

[Query.prototype.toConstructor()](#Query.prototype.toConstructor())

`Query.prototype.toConstructor()`

«Query»subclass-of-Query

- «Query»subclass-of-Query


Converts this query to a customized, reusable query constructor with all arguments and options retained.


#### Example:

[Example:](#example)


```javascript
// Create a query for adventure movies and read from the primary// node in the replica-set unless it is down, in which case we'll// read from a secondary node.constquery =Movie.find({tags:'adventure'}).read('primaryPreferred');// create a custom Query constructor based off these settingsconstAdventure= query.toConstructor();// further narrow down our query results while still using the previous settingsawaitAdventure().where({name:/^Life/}).exec();// since Adventure is a stand-alone constructor we can also add our own// helper methods and getters without impacting global queriesAdventure.prototype.startsWith=function(prefix) {this.where({name:newRegExp('^'+ prefix) })returnthis;
}Object.defineProperty(Adventure.prototype,'highlyRated', {get:function() {this.where({rating: {$gt:4.5}});returnthis;
  }
})awaitAdventure().highlyRated.startsWith('Life').exec();
```


### Query.prototype.transform()

[Query.prototype.transform()](#Query.prototype.transform())

`Query.prototype.transform()`

fn«Function»function to run to transform the query result

- fn«Function»function to run to transform the query result

`fn`

«Query»this

- «Query»this


Runs a functionfnand treats the return value offnas the new value
for the query to resolve to.

`fn`
`fn`

Any functions you pass totransform()will runafterany post hooks.

`transform()`

#### Example:

[Example:](#example)


```javascript
constres =awaitMyModel.findOne().transform(res=>{// Sets a `loadedAt` property on the doc that tells you the time the// document was loaded.returnres ==null?
    res :Object.assign(res, {loadedAt:newDate() });
});
```


### Query.prototype.updateMany()

[Query.prototype.updateMany()](#Query.prototype.updateMany())

`Query.prototype.updateMany()`

[filter]«Object»[update]«Object|Array»the update command. If array, this update will be treated as an update pipeline and not casted.[options]«Object»[options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.[options.strict]«Boolean|String»overwrites the schema'sstrict mode option[options.upsert=false]«Boolean»if true, and no documents found, insert a new document[options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.[options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key[options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.[callback]«Function»params are (error, writeOpResult)

- [filter]«Object»

`[filter]`
- [update]«Object|Array»the update command. If array, this update will be treated as an update pipeline and not casted.

`[update]`
- [options]«Object»

`[options]`

[options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.

- [options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.

`[options.multipleCastError]`

[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [options.strict]«Boolean|String»overwrites the schema'sstrict mode option

`[options.strict]`

[options.upsert=false]«Boolean»if true, and no documents found, insert a new document

- [options.upsert=false]«Boolean»if true, and no documents found, insert a new document

`[options.upsert=false]`

[options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern

- [options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern

`[options.writeConcern=null]`

[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.

- [options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Does nothing if schema-level timestamps are not set.

`[options.timestamps=null]`
`false`

[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

- [options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

`[options.translateAliases=null]`
`true`
`filter`
`projection`
`update`
`distinct`

[options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key

- [options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key

`[options.overwriteDiscriminatorKey=false]`
`update`
`overwriteDiscriminatorKey`
`true`

[options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.

- [options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.

`[options.overwriteImmutable=false]`
`update`
`overwriteImmutable`
`true`
- [callback]«Function»params are (error, writeOpResult)

`[callback]`

«Query»this

- «Query»this


Model.updateQuery docsupdateUpdateResultMongoDB docs

- Model.update

[Model.update](/docs/api/model.html#Model.update())

- Query docs

[Query docs](/docs/queries.html)

- update

[update](https://www.mongodb.com/docs/manual/reference/method/db.collection.update/)

- UpdateResult

[UpdateResult](https://mongodb.github.io/node-mongodb-native/4.9/interfaces/UpdateResult.html)

- MongoDB docs

[MongoDB docs](https://www.mongodb.com/docs/manual/reference/command/update/#update-command-output)


Declare and/or execute this query as an updateMany() operation.
MongoDB will updatealldocuments that matchfilter(as opposed to just the first one).

`filter`

NoteupdateMany willnotfire update middleware. Usepre('updateMany')andpost('updateMany')instead.

`pre('updateMany')`
`post('updateMany')`

#### Example:

[Example:](#example)


```javascript
constres =awaitPerson.updateMany({name:/Stark$/}, {isDeleted:true});
res.n;// Number of documents matchedres.nModified;// Number of documents modified
```


This function triggers the following middleware.


updateMany()

- updateMany()

`updateMany()`

### Query.prototype.updateOne()

[Query.prototype.updateOne()](#Query.prototype.updateOne())

`Query.prototype.updateOne()`

[filter]«Object»[update]«Object|Array»the update command. If array, this update will be treated as an update pipeline and not casted.[options]«Object»[options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.[options.strict]«Boolean|String»overwrites the schema'sstrict mode option[options.upsert=false]«Boolean»if true, and no documents found, insert a new document[options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.[options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key[options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.[callback]«Function»params are (error, writeOpResult)

- [filter]«Object»

`[filter]`
- [update]«Object|Array»the update command. If array, this update will be treated as an update pipeline and not casted.

`[update]`
- [options]«Object»

`[options]`

[options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.

- [options.multipleCastError]«Boolean»by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.

`[options.multipleCastError]`

[options.strict]«Boolean|String»overwrites the schema'sstrict mode option

- [options.strict]«Boolean|String»overwrites the schema'sstrict mode option

`[options.strict]`

[options.upsert=false]«Boolean»if true, and no documents found, insert a new document

- [options.upsert=false]«Boolean»if true, and no documents found, insert a new document

`[options.upsert=false]`

[options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern

- [options.writeConcern=null]«Object»sets thewrite concernfor replica sets. Overrides theschema-level write concern

`[options.writeConcern=null]`

[options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.

- [options.timestamps=null]«Boolean»If set tofalseandschema-level timestampsare enabled, skip timestamps for this update. Note that this allows you to overwrite timestamps. Does nothing if schema-level timestamps are not set.

`[options.timestamps=null]`
`false`

[options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

- [options.translateAliases=null]«Boolean»If set totrue, translates any schema-defined aliases infilter,projection,update, anddistinct. Throws an error if there are any conflicts where both alias and raw property are defined on the same object.

`[options.translateAliases=null]`
`true`
`filter`
`projection`
`update`
`distinct`

[options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key

- [options.overwriteDiscriminatorKey=false]«Boolean»Mongoose removes discriminator key updates fromupdateby default, setoverwriteDiscriminatorKeytotrueto allow updating the discriminator key

`[options.overwriteDiscriminatorKey=false]`
`update`
`overwriteDiscriminatorKey`
`true`

[options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.

- [options.overwriteImmutable=false]«Boolean»Mongoose removes updated immutable properties fromupdateby default (excluding $setOnInsert). SetoverwriteImmutabletotrueto allow updating immutable properties using other update operators.

`[options.overwriteImmutable=false]`
`update`
`overwriteImmutable`
`true`
- [callback]«Function»params are (error, writeOpResult)

`[callback]`

«Query»this

- «Query»this


Model.updateQuery docsupdateUpdateResultMongoDB docs

- Model.update

[Model.update](/docs/api/model.html#Model.update())

- Query docs

[Query docs](/docs/queries.html)

- update

[update](https://www.mongodb.com/docs/manual/reference/method/db.collection.update/)

- UpdateResult

[UpdateResult](https://mongodb.github.io/node-mongodb-native/4.9/interfaces/UpdateResult.html)

- MongoDB docs

[MongoDB docs](https://www.mongodb.com/docs/manual/reference/command/update/#update-command-output)


Declare and/or execute this query as an updateOne() operation.
MongoDB will updateonlythe first document that matchesfilter.

`filter`

UsereplaceOne()if you want to overwrite an entire document rather than usingatomic operatorslike$set.

- UsereplaceOne()if you want to overwrite an entire document rather than usingatomic operatorslike$set.

`replaceOne()`
`$set`

NoteupdateOne willnotfire update middleware. Usepre('updateOne')andpost('updateOne')instead.

`pre('updateOne')`
`post('updateOne')`

#### Example:

[Example:](#example)


```javascript
constres =awaitPerson.updateOne({name:'Jean-Luc Picard'}, {ship:'USS Enterprise'});
res.acknowledged;// Indicates if this write result was acknowledged. If not, then all other members of this result will be undefined.res.matchedCount;// Number of documents that matched the filterres.modifiedCount;// Number of documents that were modifiedres.upsertedCount;// Number of documents that were upsertedres.upsertedId;// Identifier of the inserted document (if an upsert took place)
```


This function triggers the following middleware.


updateOne()

- updateOne()

`updateOne()`

### Query.prototype.w()

[Query.prototype.w()](#Query.prototype.w())

`Query.prototype.w()`

val«String|number»0 for fire-and-forget, 1 for acknowledged by one server, 'majority' for majority of the replica set, orany of the more advanced options.

- val«String|number»0 for fire-and-forget, 1 for acknowledged by one server, 'majority' for majority of the replica set, orany of the more advanced options.

`val`

«Query»this

- «Query»this


mongodb

- mongodb

[mongodb](https://www.mongodb.com/docs/manual/reference/write-concern/#w-option)


Sets the specified number ofmongodservers, or tag set ofmongodservers,
that must acknowledge this write before this write is considered successful.
This option is only valid for operations that write to the database:

`mongod`
`mongod`

deleteOne()deleteMany()findOneAndDelete()findOneAndReplace()findOneAndUpdate()updateOne()updateMany()

- deleteOne()

`deleteOne()`
- deleteMany()

`deleteMany()`
- findOneAndDelete()

`findOneAndDelete()`
- findOneAndReplace()

`findOneAndReplace()`
- findOneAndUpdate()

`findOneAndUpdate()`
- updateOne()

`updateOne()`
- updateMany()

`updateMany()`

Defaults to the schema'swriteConcern.woption

[writeConcern.woption](/docs/guide.html#writeConcern)

`writeConcern.w`

#### Example:

[Example:](#example)


```javascript
// The 'majority' option means the `deleteOne()` promise won't resolve// until the `deleteOne()` has propagated to the majority of the replica setawaitmongoose.model('Person').deleteOne({name:'Ned Stark'}).w('majority');
```


### Query.prototype.where()

[Query.prototype.where()](#Query.prototype.where())

`Query.prototype.where()`

[path]«String|Object»[val]«any»

- [path]«String|Object»

`[path]`
- [val]«any»

`[val]`

«Query»this

- «Query»this


Specifies apathfor use with chaining.

`path`

#### Example:

[Example:](#example)


```javascript
// instead of writing:User.find({age: {$gte:21,$lte:65}});// we can instead write:User.where('age').gte(21).lte(65);// passing query conditions is permittedUser.find().where({name:'vonderful'})// chainingUser.where('age').gte(21).lte(65)
.where('name',/^vonderful/i)
.where('friends').slice(10)
.exec()
```


### Query.prototype.within()

[Query.prototype.within()](#Query.prototype.within())

`Query.prototype.within()`

«Query»this

- «Query»this


$polygon$box$geometry$center$centerSphere

- $polygon

[$polygon](https://www.mongodb.com/docs/manual/reference/operator/polygon/)

- $box

[$box](https://www.mongodb.com/docs/manual/reference/operator/box/)

- $geometry

[$geometry](https://www.mongodb.com/docs/manual/reference/operator/geometry/)

- $center

[$center](https://www.mongodb.com/docs/manual/reference/operator/center/)

- $centerSphere

[$centerSphere](https://www.mongodb.com/docs/manual/reference/operator/centerSphere/)


Defines a$withinor$geoWithinargument for geo-spatial queries.

`$within`
`$geoWithin`

#### Example:

[Example:](#example)


```javascript
query.where(path).within().box()
query.where(path).within().circle()
query.where(path).within().geometry()

query.where('loc').within({center: [50,50],radius:10,unique:true,spherical:true});
query.where('loc').within({box: [[40.73, -73.9], [40.7, -73.988]] });
query.where('loc').within({polygon: [[],[],[],[]] });

query.where('loc').within([], [], [])// polygonquery.where('loc').within([], [])// boxquery.where('loc').within({type:'LineString',coordinates: [...] });// geometry
```


MUSTbe used afterwhere().

`where()`

#### Note:

[Note:](#note)


As of Mongoose 3.7,$geoWithinis always used for queries. To change this behavior, seeQuery.use$geoWithin.

`$geoWithin`
[Query.use$geoWithin](#Query.prototype.use$geoWithin)


#### Note:

[Note:](#note)


In Mongoose 3.7,withinchanged from a getter to a function. If you need the old syntax, usethis.

`within`
[this](https://github.com/ebensing/mongoose-within)


### Query.prototype.writeConcern()

[Query.prototype.writeConcern()](#Query.prototype.writeConcern())

`Query.prototype.writeConcern()`

writeConcern«Object»the write concern value to set

- writeConcern«Object»the write concern value to set

`writeConcern`

«Query»this

- «Query»this


WriteConcernSettings

- WriteConcernSettings

[WriteConcernSettings](https://mongodb.github.io/node-mongodb-native/4.9/interfaces/WriteConcernSettings.html)


Sets the 3 write concern parameters for this query:


w: Sets the specified number ofmongodservers, or tag set ofmongodservers, that must acknowledge this write before this write is considered successful.j: Boolean, set totrueto request acknowledgement that this operation has been persisted to MongoDB's on-disk journal.wtimeout: Ifw > 1, the maximum amount of time to wait for this write to propagate through the replica set before this operation fails. The default is0, which means no timeout.

- w: Sets the specified number ofmongodservers, or tag set ofmongodservers, that must acknowledge this write before this write is considered successful.

`w`
`mongod`
`mongod`
- j: Boolean, set totrueto request acknowledgement that this operation has been persisted to MongoDB's on-disk journal.

`j`
`true`
- wtimeout: Ifw > 1, the maximum amount of time to wait for this write to propagate through the replica set before this operation fails. The default is0, which means no timeout.

`wtimeout`
`w > 1`
`0`

This option is only valid for operations that write to the database:


deleteOne()deleteMany()findOneAndDelete()findOneAndReplace()findOneAndUpdate()updateOne()updateMany()

- deleteOne()

`deleteOne()`
- deleteMany()

`deleteMany()`
- findOneAndDelete()

`findOneAndDelete()`
- findOneAndReplace()

`findOneAndReplace()`
- findOneAndUpdate()

`findOneAndUpdate()`
- updateOne()

`updateOne()`
- updateMany()

`updateMany()`

Defaults to the schema'swriteConcernoption

[writeConcernoption](/docs/guide.html#writeConcern)

`writeConcern`

#### Example:

[Example:](#example)


```javascript
// The 'majority' option means the `deleteOne()` promise won't resolve// until the `deleteOne()` has propagated to the majority of the replica setawaitmongoose.model('Person').deleteOne({name:'Ned Stark'}).writeConcern({w:'majority'});
```


### Query.prototype.wtimeout()

[Query.prototype.wtimeout()](#Query.prototype.wtimeout())

`Query.prototype.wtimeout()`

ms«number»number of milliseconds to wait

- ms«number»number of milliseconds to wait

`ms`

«Query»this

- «Query»this


mongodb

- mongodb

[mongodb](https://www.mongodb.com/docs/manual/reference/write-concern/#wtimeout)


Ifw > 1, the maximum amount of time to
wait for this write to propagate through the replica set before this
operation fails. The default is0, which means no timeout.

[w > 1](#Query.prototype.w())

`w > 1`
`0`

This option is only valid for operations that write to the database:


deleteOne()deleteMany()findOneAndDelete()findOneAndReplace()findOneAndUpdate()updateOne()updateMany()

- deleteOne()

`deleteOne()`
- deleteMany()

`deleteMany()`
- findOneAndDelete()

`findOneAndDelete()`
- findOneAndReplace()

`findOneAndReplace()`
- findOneAndUpdate()

`findOneAndUpdate()`
- updateOne()

`updateOne()`
- updateMany()

`updateMany()`

Defaults to the schema'swriteConcern.wtimeoutoption

[writeConcern.wtimeoutoption](/docs/guide.html#writeConcern)

`writeConcern.wtimeout`

#### Example:

[Example:](#example)


```javascript
// The `deleteOne()` promise won't resolve until this `deleteOne()` has// propagated to at least `w = 2` members of the replica set. If it takes// longer than 1 second, this `deleteOne()` will fail.awaitmongoose.model('Person').deleteOne({name:'Ned Stark'}).w(2).wtimeout(1000);
```


### Query.prototype[Symbol.asyncIterator]()

[Query.prototype[Symbol.asyncIterator]()](#Query.prototype[Symbol.asyncIterator]())

`Query.prototype[Symbol.asyncIterator]()`

Returns an asyncIterator for use withfor/await/ofloopsThis functiononlyworks forfind()queries.
You do not need to call this function explicitly, the JavaScript runtime
will call it for you.

[for/await/ofloops](https://thecodebarbarian.com/getting-started-with-async-iterators-in-node-js)

`for/await/of`
`find()`

#### Example:

[Example:](#example)


```javascript
forawait(constdocofModel.aggregate([{$sort: {name:1} }])) {console.log(doc.name);
}
```


Node.js 10.x supports async iterators natively without any flags. You can
enable async iterators in Node.js 8.x using the--harmony_async_iterationflag.

[--harmony_async_iterationflag](https://github.com/tc39/proposal-async-iteration/issues/117#issuecomment-346695187)

`--harmony_async_iteration`

Note:This function is not ifSymbol.asyncIteratoris undefined. IfSymbol.asyncIteratoris undefined, that means your Node.js version does not
support async iterators.

`Symbol.asyncIterator`
`Symbol.asyncIterator`

### Query.prototype[Symbol.toStringTag]()

[Query.prototype[Symbol.toStringTag]()](#Query.prototype[Symbol.toStringTag]())

`Query.prototype[Symbol.toStringTag]()`

«String»

- «String»


Returns a string representation of this query.


More abouttoString()in JavaScript.

[toString()in JavaScript](https://masteringjs.io/tutorials/fundamentals/tostring)

`toString()`

#### Example:

[Example:](#example)


```javascript
constq =Model.find();console.log(q);// Prints "Query { find }"
```


### Query.use$geoWithin

[Query.use$geoWithin](#Query.use$geoWithin)

`Query.use$geoWithin`

«property»

- «property»


geoWithin

- geoWithin

[geoWithin](https://www.mongodb.com/docs/manual/reference/operator/geoWithin/)


Flag to opt out of using$geoWithin.

`$geoWithin`

```javascript
mongoose.Query.use$geoWithin=false;
```


MongoDB 2.4 deprecated the use of$within, replacing it with$geoWithin. Mongoose uses$geoWithinby default (which is 100% backward compatible with$within). If you are running an older version of MongoDB, set this flag tofalseso yourwithin()queries continue to work.

`$within`
`$geoWithin`
`$geoWithin`
`$within`
`false`
`within()`

[Source](https://mongoosejs.com/docs/api/query.html#Query.prototype.then)